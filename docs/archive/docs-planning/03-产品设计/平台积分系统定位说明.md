# ğŸ›ï¸ å¹³å°ç§¯åˆ†ç³»ç»Ÿæ­£ç¡®æ¶æ„è®¾è®¡

## ğŸ¯ **æ ¸å¿ƒç†å¿µæ¾„æ¸…**

**ç§¯åˆ†ç³»ç»Ÿ = å¹³å°æ–¹èµ„äº§ï¼Œä¸å±äºä»»ä½•å•†æˆ·ï¼**

- âœ… **å•†æˆ·**: æä¾›ä¸“å±æ”¶æ¬¾äºŒç»´ç 
- âœ… **å¹³å°**: æ‹¥æœ‰ç§¯åˆ†ç³»ç»Ÿï¼Œå‘ç”¨æˆ·å‘æ”¾ç§¯åˆ†
- âœ… **ç”¨æˆ·**: åœ¨ä»»ä½•åˆä½œå•†æˆ·æ¶ˆè´¹éƒ½è·å¾—å¹³å°ç§¯åˆ†
- âœ… **ç§¯åˆ†**: åªèƒ½åœ¨å¹³å°ç§¯åˆ†å•†åŸä½¿ç”¨

## ğŸ—ï¸ **æ­£ç¡®çš„ç³»ç»Ÿæ¶æ„**

### **æ¶æ„å±‚æ¬¡**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¹³å°ç§¯åˆ†ç³»ç»Ÿ              â”‚  â† æˆ‘ä»¬çš„æ ¸å¿ƒèµ„äº§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å•†æˆ·A  â”‚  å•†æˆ·B  â”‚  å•†æˆ·C  â”‚ ... â”‚  â† åˆä½œå•†æˆ·
â”‚ äºŒç»´ç   â”‚ äºŒç»´ç   â”‚ äºŒç»´ç   â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ä¸šåŠ¡å…³ç³»**
- ğŸª **å•†æˆ·**: è·å¾—æ”¶æ¬¾å·¥å…·ï¼ˆäºŒç»´ç ï¼‰+ å®¢æµå¢åŠ 
- ğŸ›ï¸ **å¹³å°**: æ‹¥æœ‰ç”¨æˆ·ç§¯åˆ†æ•°æ® + ç§¯åˆ†å•†åŸæ”¶å…¥
- ğŸ‘¥ **ç”¨æˆ·**: ä»»ä½•å•†æˆ·æ¶ˆè´¹éƒ½è·å¾—ç»Ÿä¸€çš„å¹³å°ç§¯åˆ†

## ğŸ’° **å¹³å°æ–¹æ”¶ç›Šæ¨¡å‹**

### **1. ç§¯åˆ†å•†åŸæ”¶å…¥ï¼ˆä¸»è¦ï¼‰**
- **ç”¨æˆ·æ¶ˆè´¹è·å¾—ç§¯åˆ†** â†’ **ç§¯åˆ†å•†åŸå…‘æ¢å•†å“** â†’ **å¹³å°è·å¾—åˆ©æ¶¦**
- **ç§¯åˆ†æˆæœ¬**: æ”¯ä»˜é‡‘é¢çš„2-3%
- **å•†åŸæ¯›åˆ©**: 30-50%
- **å‡€åˆ©æ¶¦**: ç§¯åˆ†æˆæœ¬çš„10-20å€

### **2. å•†æˆ·æœåŠ¡è´¹**
- **äºŒç»´ç æœåŠ¡è´¹**: æ¯æœˆ50-100å…ƒ/å•†æˆ·
- **äº¤æ˜“æ‰‹ç»­è´¹**: 0.1-0.2%ï¼ˆå¾ˆä½ï¼Œä¸»è¦æ˜¯æœåŠ¡è´¹ï¼‰
- **å¢å€¼æœåŠ¡**: æ•°æ®åˆ†æã€è¥é”€å·¥å…·

### **3. ç”¨æˆ·æ•°æ®ä»·å€¼**
- **æ¶ˆè´¹è¡Œä¸ºæ•°æ®**: äº†è§£ç”¨æˆ·åå¥½
- **å•†æˆ·è¯„ä¼°**: å¸®åŠ©ä¼˜è´¨å•†æˆ·æ‰©å¼ 
- **ç²¾å‡†è¥é”€**: å‘ç”¨æˆ·æ¨èåˆé€‚å•†æˆ·

## ğŸ› ï¸ **æŠ€æœ¯å®ç°æ¶æ„**

### **1. å•†æˆ·ç®¡ç†ï¼ˆå·¥å…·æä¾›æ–¹ï¼‰**
```typescript
// å•†æˆ·åªæ˜¯æˆ‘ä»¬çš„åˆä½œä¼™ä¼´ï¼Œä¸æ‹¥æœ‰ç§¯åˆ†ç³»ç»Ÿ
interface Merchant {
  id: string;
  name: string;
  wechatMerchantId: string;
  qrCodeId: string;           // å…³è”çš„äºŒç»´ç ID
  commissionRate: number;     // æˆ‘ä»¬æ”¶å–çš„æ‰‹ç»­è´¹ç‡
  status: 'active' | 'inactive';
  
  // å•†æˆ·æ²¡æœ‰ç§¯åˆ†ç›¸å…³å­—æ®µï¼
  // ç§¯åˆ†è§„åˆ™ç”±å¹³å°ç»Ÿä¸€åˆ¶å®š
}
```

### **2. å¹³å°ç§¯åˆ†ç³»ç»Ÿï¼ˆæ ¸å¿ƒèµ„äº§ï¼‰**
```typescript
// ç§¯åˆ†ç³»ç»Ÿå®Œå…¨å±äºå¹³å°
interface PlatformPointsConfig {
  baseRatio: number;          // åŸºç¡€ç§¯åˆ†æ¯”ä¾‹ï¼š1å…ƒ=Xç§¯åˆ†
  merchantBonus: {            // ç‰¹å®šå•†æˆ·é¢å¤–å¥–åŠ±
    [merchantId: string]: number;
  };
  userLevelBonus: {           // ç”¨æˆ·ç­‰çº§å¥–åŠ±
    silver: number;
    gold: number;
    platinum: number;
  };
  campaignBonus: {            // æ´»åŠ¨æœŸé—´å¥–åŠ±
    startDate: Date;
    endDate: Date;
    multiplier: number;
  };
}

interface UserPoints {
  userId: string;
  totalPoints: number;        // æ€»ç§¯åˆ†ä½™é¢
  totalEarned: number;        // ç´¯è®¡è·å¾—
  totalSpent: number;         // ç´¯è®¡æ¶ˆè´¹
  level: 'bronze' | 'silver' | 'gold' | 'platinum';
  
  // ç§¯åˆ†æ¥æºè®°å½•ï¼ˆè·¨æ‰€æœ‰å•†æˆ·ï¼‰
  earnHistory: PointsRecord[];
  spentHistory: PointsRecord[];
}
```

### **3. ç§¯åˆ†è·å¾—æµç¨‹**
```typescript
class PlatformPointsService {
  
  // ç”¨æˆ·åœ¨ä»»ä½•å•†æˆ·æ¶ˆè´¹éƒ½é€šè¿‡å¹³å°ç§¯åˆ†ç³»ç»Ÿè®¡ç®—
  static async calculatePointsReward(
    userId: string,
    merchantId: string, 
    paymentAmount: number
  ): Promise<number> {
    
    // 1. è·å–å¹³å°ç§¯åˆ†é…ç½®
    const config = await this.getPlatformPointsConfig();
    
    // 2. è®¡ç®—åŸºç¡€ç§¯åˆ†
    let points = Math.floor(paymentAmount * config.baseRatio);
    
    // 3. å•†æˆ·é¢å¤–å¥–åŠ±ï¼ˆå¹³å°å†³å®šï¼Œä¸æ˜¯å•†æˆ·å†³å®šï¼‰
    const merchantBonus = config.merchantBonus[merchantId] || 0;
    points += Math.floor(paymentAmount * merchantBonus);
    
    // 4. ç”¨æˆ·ç­‰çº§å¥–åŠ±
    const user = await UserModel.findById(userId);
    const levelBonus = config.userLevelBonus[user.level] || 0;
    points += Math.floor(paymentAmount * levelBonus);
    
    // 5. æ´»åŠ¨æœŸé—´å¥–åŠ±
    if (this.isInCampaignPeriod(config.campaignBonus)) {
      points *= config.campaignBonus.multiplier;
    }
    
    return points;
  }
  
  // å‘æ”¾ç§¯åˆ†ï¼ˆè®°å½•æ¥æºå•†æˆ·ï¼Œä½†ç§¯åˆ†å±äºå¹³å°ï¼‰
  static async awardPoints(
    userId: string,
    merchantId: string,
    paymentAmount: number,
    orderNo: string
  ): Promise<void> {
    
    const points = await this.calculatePointsReward(userId, merchantId, paymentAmount);
    
    // ç§¯åˆ†è®°å½•å±äºå¹³å°ï¼Œåªæ˜¯è®°å½•æ¥æºå•†æˆ·
    const record = {
      userId,
      points,
      source: 'merchant_payment',
      sourceId: merchantId,    // è®°å½•æ¥æºå•†æˆ·
      orderNo,
      description: `åœ¨åˆä½œå•†æˆ·æ¶ˆè´¹è·å¾—å¹³å°ç§¯åˆ†`,
      createdAt: new Date()
    };
    
    await PointsRecordModel.create(record);
    await UserModel.updatePointsBalance(userId, points);
    
    // é€šçŸ¥ç”¨æˆ·è·å¾—äº†"å¹³å°ç§¯åˆ†"ï¼Œä¸æ˜¯"å•†æˆ·ç§¯åˆ†"
    await this.sendPointsNotification(userId, points, 'å¹³å°ç§¯åˆ†ç³»ç»Ÿ');
  }
}
```

### **4. ç§¯åˆ†ä½¿ç”¨ï¼ˆåªèƒ½åœ¨å¹³å°å•†åŸï¼‰**
```typescript
class PlatformMallService {
  
  // ç§¯åˆ†åªèƒ½åœ¨å¹³å°ç§¯åˆ†å•†åŸä½¿ç”¨
  static async exchangePoints(
    userId: string,
    productId: string,
    pointsCost: number
  ): Promise<void> {
    
    // 1. æ£€æŸ¥ç”¨æˆ·ç§¯åˆ†ä½™é¢
    const user = await UserModel.findById(userId);
    if (user.pointsBalance < pointsCost) {
      throw new Error('ç§¯åˆ†ä½™é¢ä¸è¶³');
    }
    
    // 2. æ‰£é™¤ç§¯åˆ†
    await UserModel.updatePointsBalance(userId, -pointsCost);
    
    // 3. å‘è´§/æä¾›æœåŠ¡
    await this.fulfillOrder(userId, productId);
    
    // 4. è®°å½•ç§¯åˆ†æ¶ˆè´¹
    const record = {
      userId,
      points: -pointsCost,
      source: 'mall_exchange',
      sourceId: productId,
      description: `ç§¯åˆ†å•†åŸå…‘æ¢å•†å“`,
      createdAt: new Date()
    };
    
    await PointsRecordModel.create(record);
  }
}
```

## ğŸª **å•†æˆ·ä»·å€¼ä¸»å¼ **

### **å¯¹å•†æˆ·çš„ä»·å€¼ï¼ˆæˆ‘ä»¬æä¾›çš„æœåŠ¡ï¼‰**
- ğŸ¯ **å…è´¹è·å®¢å·¥å…·**: ä¸“å±æ”¶æ¬¾äºŒç»´ç 
- ğŸ“ˆ **å®¢æµå¢åŠ **: ç§¯åˆ†å¸å¼•ç”¨æˆ·æ¥æ¶ˆè´¹
- ğŸ’° **é¢å¤–æ”¶å…¥**: æ— éœ€æŠ•å…¥ï¼Œçº¯å¢é‡å®¢æˆ·
- ğŸ“Š **æ•°æ®æ”¯æŒ**: äº†è§£é€šè¿‡å¹³å°æ¥çš„å®¢æˆ·æƒ…å†µ
- ğŸ **è¥é”€æ”¯æŒ**: å¹³å°å¸®åŠ©æ¨å¹¿å•†æˆ·

### **å•†æˆ·çš„æˆæœ¬ï¼ˆå¾ˆä½ï¼‰**
- ğŸ’³ **æ‰‹ç»­è´¹**: ä»…0.1-0.2%ï¼ˆè¿œä½äºå…¶ä»–å¹³å°ï¼‰
- ğŸ“± **æœåŠ¡è´¹**: æ¯æœˆ50-100å…ƒï¼ˆè·å¾—ä¸“å±äºŒç»´ç +å®¢æµï¼‰
- ğŸ¯ **æ— å…¶ä»–æˆæœ¬**: ä¸éœ€è¦å•†æˆ·æä¾›ç§¯åˆ†æˆ–å¥–å“

## ğŸ‘¥ **ç”¨æˆ·ä»·å€¼ä¸»å¼ **

### **å¯¹ç”¨æˆ·çš„ä»·å€¼**
- ğŸ **ç»Ÿä¸€ç§¯åˆ†**: åœ¨ä»»ä½•åˆä½œå•†æˆ·æ¶ˆè´¹éƒ½è·å¾—åŒä¸€ä¸ªç§¯åˆ†
- ğŸ›ï¸ **ä¸°å¯Œå•†åŸ**: ç§¯åˆ†å¯å…‘æ¢å„ç§å•†å“å’ŒæœåŠ¡
- ğŸ“± **ä¾¿æ·æ”¯ä»˜**: æ‰«ç å³ä»˜ï¼Œè‡ªåŠ¨è·ç§¯åˆ†
- ğŸ† **ç­‰çº§æˆé•¿**: æ¶ˆè´¹è¶Šå¤šç­‰çº§è¶Šé«˜ï¼Œç§¯åˆ†å€ç‡è¶Šé«˜

### **å¹³å°ä¼˜åŠ¿**
- ğŸ”„ **ç”Ÿæ€é—­ç¯**: æ¶ˆè´¹â†’ç§¯åˆ†â†’å•†åŸâ†’å¤è´­
- ğŸ¯ **è·¨å•†æˆ·é€šç”¨**: ä¸€ä¸ªç§¯åˆ†è´¦æˆ·ï¼Œæ‰€æœ‰å•†æˆ·é€šç”¨
- ğŸ“Š **ä¸ªæ€§åŒ–**: åŸºäºæ¶ˆè´¹æ•°æ®çš„ä¸ªæ€§åŒ–æ¨è
- ğŸ‰ **æ´»åŠ¨ä¸°å¯Œ**: å¹³å°å®šæœŸä¸¾åŠç§¯åˆ†æ´»åŠ¨

## ğŸ’¡ **å…³é”®æˆåŠŸå› ç´ **

### **1. å¹³å°å®šä½æ¸…æ™°**
- **æˆ‘ä»¬ä¸æ˜¯æ”¯ä»˜å·¥å…·** - æˆ‘ä»¬æ˜¯ç§¯åˆ†è¥é”€å¹³å°
- **æˆ‘ä»¬ä¸æœåŠ¡å•†æˆ·** - æˆ‘ä»¬æœåŠ¡æ¶ˆè´¹è€…
- **å•†æˆ·æ˜¯åˆä½œä¼™ä¼´** - å…±åŒä¸ºç”¨æˆ·åˆ›é€ ä»·å€¼

### **2. ç§¯åˆ†ä»·å€¼ç»´æŠ¤**
- **ç§¯åˆ†æœ‰çœŸå®ä»·å€¼** - å¯å…‘æ¢å®ç”¨å•†å“
- **å…‘æ¢ä¾¿æ·** - ç§¯åˆ†å•†åŸä½“éªŒå¥½
- **æŒç»­å¢å€¼** - ç§¯åˆ†ä¸è´¬å€¼ï¼Œç”šè‡³å¢å€¼

### **3. å•†æˆ·ç½‘ç»œæ‰©å¼ **
- **é€‰æ‹©ä¼˜è´¨å•†æˆ·** - ç¡®ä¿ç”¨æˆ·æ¶ˆè´¹ä½“éªŒ
- **è¦†ç›–æ—¥å¸¸æ¶ˆè´¹** - é¤é¥®ã€é›¶å”®ã€æœåŠ¡å…¨è¦†ç›–
- **åœ°ç†åˆ†å¸ƒåˆç†** - ç”¨æˆ·èº«è¾¹å°±æœ‰åˆä½œå•†æˆ·

## ğŸ¯ **å•†ä¸šæ¨¡å¼æ€»ç»“**

```
ç”¨æˆ·åœ¨å•†æˆ·Aæ¶ˆè´¹ â†’ è·å¾—å¹³å°ç§¯åˆ† â†’ ç§¯åˆ†å•†åŸå…‘æ¢
ç”¨æˆ·åœ¨å•†æˆ·Bæ¶ˆè´¹ â†’ è·å¾—å¹³å°ç§¯åˆ† â†’ ç§¯åˆ†å•†åŸå…‘æ¢  
ç”¨æˆ·åœ¨å•†æˆ·Cæ¶ˆè´¹ â†’ è·å¾—å¹³å°ç§¯åˆ† â†’ ç§¯åˆ†å•†åŸå…‘æ¢

ç§¯åˆ†æ¥æºï¼šå¤šä¸ªå•†æˆ·
ç§¯åˆ†å½’å±ï¼šå¹³å°æ–¹
ç§¯åˆ†ä½¿ç”¨ï¼šå¹³å°ç§¯åˆ†å•†åŸ
æ”¶å…¥æ¥æºï¼šç§¯åˆ†å•†åŸåˆ©æ¶¦ + å•†æˆ·æœåŠ¡è´¹
```

**æ ¸å¿ƒé€»è¾‘ï¼šæˆ‘ä»¬æ˜¯ç§¯åˆ†è¥é”€å¹³å°ï¼Œä¸æ˜¯å•†æˆ·æœåŠ¡å¹³å°ï¼**

---

**æ€»ç»“ï¼šç§¯åˆ†ç³»ç»Ÿæ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒèµ„äº§å’Œæ”¶å…¥æ¥æºï¼Œå•†æˆ·åªæ˜¯æˆ‘ä»¬è·å¾—ç”¨æˆ·å’Œäº¤æ˜“æµæ°´çš„åˆä½œä¼™ä¼´ï¼**
