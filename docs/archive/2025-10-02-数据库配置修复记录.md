# 2025å¹´10æœˆ2æ—¥ - æ•°æ®åº“é…ç½®ä¿®å¤è®°å½•

## ğŸ› é—®é¢˜ç°è±¡

ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œdashboardé¡µé¢æ— æ³•åŠ è½½æ•°æ®ï¼Œæ§åˆ¶å°æ˜¾ç¤ºï¼š
- `503 Service Unavailable`
- `400 Bad Request`  
- APIè¿”å›: "æ•°æ®åº“æœªè¿æ¥"

## ğŸ” é—®é¢˜è¯Šæ–­è¿‡ç¨‹

### 1. ç™»å½•APIè·¯å¾„é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰
**é—®é¢˜**: å‰ç«¯å’Œåç«¯çš„ç™»å½•APIè·¯å¾„ä¸ä¸€è‡´
- å‰ç«¯è°ƒç”¨: `/admin/auth/login`
- åç«¯è·¯ç”±: `/auth/admin/login`

**è§£å†³æ–¹æ¡ˆ**:
- ä¿®æ”¹äº† `admin-frontend/src/services/api.ts`
- ä¿®æ”¹äº† `admin-frontend/src/App.tsx`
- é‡æ–°æ„å»ºå¹¶éƒ¨ç½²å‰ç«¯

### 2. æ•°æ®åº“è¿æ¥é…ç½®é”™è¯¯
**é—®é¢˜**: `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®ä¸æ­£ç¡®

**åŸå§‹é…ç½®**:
```env
DB_USER=points_app
DB_PASSWORD=GuanDongFang2024!@#
DB_NAME=points_app
```

**å®é™…æƒ…å†µ**:
- `points_app` ç”¨æˆ·å¯†ç ä¸æ­£ç¡®ï¼Œæ— æ³•è¿æ¥
- æ•°æ®è¡¨å®é™…åœ¨ `points_app_dev` æ•°æ®åº“ä¸­

**è§£å†³æ–¹æ¡ˆ**:
```env
DB_USER=root
DB_PASSWORD=123456
DB_NAME=points_app_dev
```

### 3. æ•°æ®åº“å­—ç¬¦é›†å†²çª
**é—®é¢˜**: MySQL 8.0 å­—ç¬¦é›†ä¸ä¸€è‡´å¯¼è‡´æŸ¥è¯¢å¤±è´¥
```
Illegal mix of collations (utf8mb4_unicode_ci,IMPLICIT) and (utf8mb4_0900_ai_ci,IMPLICIT)
```

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€æ‰€æœ‰è¡¨çš„å­—ç¬¦é›†ä¸º `utf8mb4_unicode_ci`
```sql
SET FOREIGN_KEY_CHECKS = 0;

ALTER TABLE admin_operation_logs CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE admin_roles CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE admin_users CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE merchants CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE payment_orders CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE points_records CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE user_points CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE users CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;
```

## âœ… ä¿®å¤åçš„é…ç½®

### æœåŠ¡å™¨ `.env` æ–‡ä»¶
```env
NODE_ENV=production
PORT=3000

# æ•°æ®åº“é…ç½®ï¼ˆå·²ä¿®å¤ï¼‰
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=123456
DB_NAME=points_app_dev

# JWTé…ç½®
JWT_SECRET=guandongfang_points_jwt_secret_2024_secure
JWT_EXPIRES_IN=7d
```

### æ•°æ®åº“ä¿¡æ¯
- **æ•°æ®åº“å**: `points_app_dev`
- **å­—ç¬¦é›†**: `utf8mb4`
- **æ’åºè§„åˆ™**: `utf8mb4_unicode_ci`
- **è¡¨åˆ—è¡¨**:
  - admin_operation_logs
  - admin_roles
  - admin_users
  - merchants
  - payment_orders
  - points_records
  - user_points
  - users

## ğŸ§ª éªŒè¯ç»“æœ

```bash
# æµ‹è¯•ç™»å½•API
curl -X POST http://localhost:3000/api/v1/auth/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
# âœ… è¿”å›: {"success":true,"data":{"token":"..."}}

# æµ‹è¯•dashboard API
curl http://localhost:3000/api/v1/admin/dashboard/stats \
  -H "Authorization: Bearer TOKEN"
# âœ… è¿”å›: {"success":true,"data":{...}}
```

## ğŸ“ Gitæäº¤è®°å½•

1. **fec6449** - fix: ä¿®å¤ç™»å½•APIè·¯å¾„é”™è¯¯ï¼ˆapi.tsï¼‰
2. **d159389** - fix: ä¿®å¤App.tsxä¸­çš„ç™»å½•APIè·¯å¾„
3. æœåŠ¡å™¨é…ç½®æ–‡ä»¶å·²æ›´æ–°ï¼ˆæœªæäº¤åˆ°gitï¼‰

## ğŸ¯ ç³»ç»ŸçŠ¶æ€

- âœ… å‰ç«¯éƒ¨ç½²æˆåŠŸ
- âœ… åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸
- âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
- âœ… APIæ¥å£æ­£å¸¸å“åº”
- âœ… dashboardæ•°æ®å¯ä»¥æ­£å¸¸åŠ è½½

## ğŸ”§ åç»­ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ç”¨æˆ·å®‰å…¨æ€§**: 
   - åˆ›å»ºä¸“ç”¨çš„åº”ç”¨æ•°æ®åº“ç”¨æˆ·
   - è®¾ç½®å¼ºå¯†ç 
   - é™åˆ¶æƒé™ï¼ˆä¸ä½¿ç”¨rootç”¨æˆ·ï¼‰

2. **æ•°æ®åº“è§„èŒƒåŒ–**:
   - ç»Ÿä¸€ä½¿ç”¨ `points_app_dev` æˆ– `points_app`
   - æ¸…ç†ä¸ä½¿ç”¨çš„æ•°æ®åº“

3. **å­—ç¬¦é›†æ ‡å‡†åŒ–**:
   - åœ¨åˆ›å»ºæ–°è¡¨æ—¶æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†
   - å®šæœŸæ£€æŸ¥å­—ç¬¦é›†ä¸€è‡´æ€§

4. **ç¯å¢ƒå˜é‡ç®¡ç†**:
   - åŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®
   - ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†å·¥å…·

## ğŸ“Š æœ€ç»ˆé…ç½®æ€»ç»“

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|---------|---------|
| æ•°æ®åº“ä¸»æœº | 127.0.0.1 | 127.0.0.1 |
| æ•°æ®åº“ç«¯å£ | 3306 | 3306 |
| æ•°æ®åº“ç”¨æˆ· | root | root |
| æ•°æ®åº“åç§° | points_app_dev | points_app_dev |
| å­—ç¬¦é›† | utf8mb4_unicode_ci | utf8mb4_unicode_ci |

---

**ä¿®å¤æ—¶é—´**: 2025å¹´10æœˆ2æ—¥ 18:28  
**ä¿®å¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•**: âœ… é€šè¿‡

