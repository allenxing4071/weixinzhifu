# 开发者控制台使用指南

## 📋 概述

开发者控制台是一个仿照 Web3 Alpha Hunter 风格设计的可视化管理面板，为产品经理和开发人员提供快速访问系统核心功能、查看关键数据、执行常用命令的统一入口。

## 🎯 设计理念

### 产品经理视角
作为产品经理，开发者控制台帮助你:
- **快速了解系统状态**: 一眼看到核心业务数据
- **便捷访问管理功能**: 无需记忆复杂的URL路径
- **高效执行运维任务**: 一键复制常用命令
- **监控项目健康度**: 实时查看系统运行状态

### 功能定位
- ✅ 数据展示中心
- ✅ 功能入口汇总
- ✅ 命令速查手册
- ✅ 快捷操作面板

## 🚀 快速开始

### 启动方式1: 使用启动脚本 (推荐)
```bash
# 进入项目目录
cd /Users/xinghailong/Documents/soft/weixinzhifu

# 运行启动脚本
./start-dashboard.sh
```

脚本会自动:
1. 检测可用端口 (8080 或 8081)
2. 选择合适的HTTP服务器 (Python3/Node.js)
3. 启动服务并显示访问地址

### 启动方式2: 手动启动
```bash
# 使用Python3
python3 -m http.server 8080

# 或使用Node.js
npx http-server -p 8080
```

### 访问地址
打开浏览器访问: `http://localhost:8080/dashboard.html`

## 📊 功能详解

### 1. 核心数据展示区

**位置**: 页面顶部
**功能**: 实时展示系统关键指标

| 指标名称 | 数据来源 | 更新频率 |
|---------|---------|---------|
| 有消费用户 | `SELECT COUNT(DISTINCT user_id) FROM payment_orders WHERE status = 'paid'` | 30秒 |
| 活跃商户 | `SELECT COUNT(*) FROM merchants WHERE status = 'active'` | 30秒 |
| 项目版本 | 配置文件 | 静态 |

**交互特性**:
- 卡片悬停时会有轻微上浮动画
- 点击卡片可查看详细信息 (待开发)
- 渐变色背景增强视觉效果

### 2. 功能模块导航

**位置**: 核心数据下方
**功能**: 快速访问系统各个管理模块

| 模块 | 图标 | 目标地址 | 说明 |
|-----|------|---------|------|
| 用户管理 | 👥 | `/admin/#/users` | 用户数据查询、编辑、积分调整 |
| 商户管理 | 🏪 | `/admin/#/merchants` | 商户审核、编辑、统计 |
| 积分管理 | ⭐ | `/admin/#/points` | 积分配置、记录查询 |
| 订单管理 | 📦 | `/admin/#/orders` | 支付订单查询、统计 |
| API文档 | 🔌 | `/docs/02-技术实现/API接口文档.md` | 后端API接口说明 |
| 系统设置 | ⚙️ | `/admin/#/settings` | 参数配置、权限管理 |

**使用方法**:
1. 点击任意模块卡片
2. 新标签页打开对应功能
3. 收到操作提示通知

### 3. 后端API快速访问

**位置**: 功能模块下方
**功能**: 一键复制常用API地址

**包含的API**:

#### 管理后台
```
https://www.guandongfang.cn/admin/
```
用途: 访问管理后台登录页面

#### 数据统计API
```
https://www.guandongfang.cn/api/v1/admin/dashboard/stats
```
用途: 获取仪表盘统计数据

返回数据结构:
```json
{
  "success": true,
  "data": {
    "overview": {
      "totalUsers": 0,
      "activeMerchants": 0,
      "monthlyRevenue": 0,
      "monthlyOrders": 0
    },
    "today": {
      "orders": 0,
      "revenue": 0,
      "activeUsers": 0
    },
    "system": {
      "status": "healthy",
      "database": "connected"
    }
  }
}
```

**使用技巧**:
- 点击 "复制" 按钮一键复制URL
- 可在Postman/curl中直接使用
- 需要添加Authorization头

### 4. SSH登录信息

**位置**: API访问区下方
**功能**: 快速获取服务器登录信息

**包含信息**:
- 服务器IP: `8.156.84.226`
- SSH命令: `ssh -i config/ssh/weixinpay.pem root@8.156.84.226`

**使用流程**:
1. 点击 "复制" 按钮
2. 粘贴到终端
3. 确保SSH密钥文件在正确位置
4. 按回车执行登录

**注意事项**:
⚠️ SSH密钥文件路径: `/Users/xinghailong/Documents/soft/weixinzhifu/config/ssh/weixinpay.pem`
⚠️ 确保密钥文件权限为 600: `chmod 600 config/ssh/weixinpay.pem`

### 5. 常用命令集合

**位置**: SSH信息下方
**功能**: 分类整理的运维命令速查

#### Tab 1: 数据库操作

**备份MySQL数据库**
```bash
mysqldump -u root -p weixin_payment > backup_$(date +%Y%m%d).sql
```
用途: 创建带日期的数据库备份文件

**登录MySQL**
```bash
mysql -u root -p weixin_payment
```
用途: 进入MySQL控制台，进行数据查询和操作

#### Tab 2: 日志查看

**PM2日志**
```bash
# 查看所有应用日志
pm2 logs

# 查看特定应用日志
pm2 logs payment-api
```

**Nginx日志**
```bash
# 查看访问日志
tail -f /var/log/nginx/access.log

# 查看错误日志
tail -f /var/log/nginx/error.log
```

**日志分析技巧**:
- 使用 `grep` 过滤关键词: `pm2 logs | grep ERROR`
- 使用 `tail -n 100` 查看最近100行
- 使用 `Ctrl+C` 停止实时查看

#### Tab 3: 进程管理

**PM2常用命令**
```bash
# 查看所有进程
pm2 list

# 重启应用
pm2 restart payment-api

# 停止应用
pm2 stop payment-api

# 查看应用详情
pm2 show payment-api
```

**进程管理流程**:
1. `pm2 list` - 查看当前进程状态
2. `pm2 logs payment-api` - 检查日志确认问题
3. `pm2 restart payment-api` - 重启应用
4. `pm2 list` - 确认重启成功

#### Tab 4: Nginx操作

**Nginx服务管理**
```bash
# 测试配置文件
nginx -t

# 重载配置 (不中断服务)
nginx -s reload

# 重启Nginx
systemctl restart nginx

# 查看Nginx状态
systemctl status nginx
```

**配置修改流程**:
1. 编辑配置: `vim /etc/nginx/conf.d/guandongfang.conf`
2. 测试配置: `nginx -t`
3. 重载配置: `nginx -s reload`
4. 查看状态: `systemctl status nginx`

### 6. 快捷操作

**位置**: 页面底部
**功能**: 一键执行常用运维任务

#### 🚀 部署管理后台
**操作**: 点击卡片
**执行**: `scripts/deploy/deploy-admin-complete.sh`
**用途**: 
- 构建前端代码
- 上传到服务器
- 重启Nginx

**执行前检查**:
- ✅ 本地代码已提交
- ✅ 前端构建无错误
- ✅ 服务器SSH连接正常

#### ⚙️ 部署后端服务
**操作**: 点击卡片
**执行**: `scripts/deploy/deploy-backend-complete.sh`
**用途**:
- 上传后端代码
- 安装依赖
- 重启PM2进程

**执行前检查**:
- ✅ 后端代码已测试
- ✅ 数据库迁移脚本已准备
- ✅ 环境变量已配置

#### 🧪 运行测试
**操作**: 点击卡片
**执行**: Playwright测试套件
**用途**: 执行端到端自动化测试

**测试覆盖**:
- 登录功能
- 用户管理CRUD
- 商户管理CRUD
- 订单查询
- 积分管理

#### 🧹 项目清理
**操作**: 点击卡片
**执行**: 清理临时文件
**用途**:
- 删除日志文件
- 清理node_modules
- 删除构建缓存

#### 📚 查看文档
**操作**: 点击卡片
**打开**: `docs/README.md`
**用途**: 查看项目完整文档

#### 🔍 系统状态
**操作**: 点击卡片
**执行**: 检查系统健康度
**检查项**:
- API服务是否响应
- 数据库连接状态
- PM2进程状态
- Nginx服务状态

## ⌨️ 快捷键

控制台支持以下键盘快捷键:

| 快捷键 | 功能 | 状态 |
|-------|------|------|
| `Cmd/Ctrl + K` | 快速搜索 | 开发中 |
| `Cmd/Ctrl + D` | 打开文档 | ✅ 可用 |
| `Cmd/Ctrl + R` | 刷新数据 | ✅ 可用 |

**使用场景**:
- 需要快速查找功能时按 `Cmd+K`
- 查阅项目文档时按 `Cmd+D`
- 更新数据时按 `Cmd+R` (不会刷新整个页面)

## 🎨 界面说明

### 配色方案

| 颜色类型 | 颜色值 | 用途 |
|---------|--------|------|
| 主色调 | `#5B67F1` | 按钮、链接、强调 |
| 成功色 | `#52C41A` | 成功状态、正面提示 |
| 警告色 | `#FAAD14` | 警告信息、待处理 |
| 错误色 | `#FF4D4F` | 错误状态、危险操作 |
| 信息色 | `#1890FF` | 一般提示信息 |

### 动画效果

**卡片悬停**:
- 上浮4px
- 增加阴影
- 过渡时间0.3秒

**通知提示**:
- 从右侧滑入
- 3秒后自动消失
- 点击可立即关闭

**页面加载**:
- 淡入动画
- 从下向上20px

## 🔧 配置说明

### JavaScript配置
文件: `dashboard.js`

```javascript
const CONFIG = {
    // API基础URL
    API_BASE_URL: 'https://www.guandongfang.cn/api/v1',
    
    // 管理后台URL
    ADMIN_URL: 'https://www.guandongfang.cn/admin/',
    
    // 数据刷新间隔 (毫秒)
    REFRESH_INTERVAL: 30000,
};
```

**可调整参数**:
- `API_BASE_URL`: 更换为其他环境的API地址
- `REFRESH_INTERVAL`: 调整数据刷新频率

### 本地开发配置
如需在本地开发环境使用:

```javascript
const CONFIG = {
    API_BASE_URL: 'http://localhost:3000/api/v1',
    ADMIN_URL: 'http://localhost:3001/admin/',
    REFRESH_INTERVAL: 5000, // 更频繁的刷新
};
```

## 🔐 权限与安全

### Token管理
控制台使用localStorage存储管理员Token:

```javascript
// 设置Token
localStorage.setItem('admin_token', 'your-jwt-token');

// 获取Token
const token = localStorage.getItem('admin_token');
```

### 权限要求

| 功能 | 需要权限 |
|------|---------|
| 查看核心数据 | 需要有效Token |
| 访问管理模块 | 管理员登录 |
| 复制命令 | 无需权限 |
| 执行部署 | SSH服务器权限 |
| 查看文档 | 无需权限 |

### 安全建议
⚠️ **不要**在控制台中存储密码
⚠️ **不要**将Token提交到Git
⚠️ **定期**更换管理员密码
⚠️ **使用**HTTPS访问生产环境

## 📊 数据流程

### 数据加载流程
```
页面加载
  ↓
检查localStorage中的token
  ↓
请求 /api/v1/admin/dashboard/stats
  ↓
解析返回数据
  ↓
更新UI显示
  ↓
设置30秒后刷新
```

### 错误处理
```
API请求失败
  ↓
在控制台记录错误
  ↓
使用默认数据
  ↓
显示错误通知
  ↓
继续定时刷新
```

## 🐛 常见问题

### Q1: 数据显示为默认值 (8000/3000)
**原因**: 
- API请求失败
- Token过期或无效
- 网络连接问题

**解决方法**:
1. 打开浏览器开发者工具 (F12)
2. 查看Console标签页的错误信息
3. 检查Network标签页的API请求状态
4. 重新登录获取新Token

### Q2: 复制按钮无效
**原因**:
- 浏览器不支持Clipboard API
- 页面使用HTTP而非HTTPS

**解决方法**:
- 使用localhost或HTTPS访问
- 系统会自动降级使用传统复制方式

### Q3: 快捷操作无反应
**原因**:
- 功能仅为前端演示
- 需要后端API支持

**解决方法**:
- 手动执行对应的脚本
- 通过SSH登录服务器执行

### Q4: 页面样式错乱
**原因**:
- CSS文件加载失败
- 浏览器缓存问题

**解决方法**:
1. 检查dashboard.css是否在同一目录
2. 清除浏览器缓存 (Cmd+Shift+R / Ctrl+F5)
3. 检查浏览器控制台的资源加载错误

## 📈 使用技巧

### 技巧1: 快速复制多个命令
1. 准备一个文本编辑器
2. 逐个点击复制按钮
3. 粘贴到编辑器形成脚本
4. 批量执行

### 技巧2: 自定义刷新频率
修改 `dashboard.js` 中的 `REFRESH_INTERVAL`:
```javascript
REFRESH_INTERVAL: 10000, // 改为10秒
```

### 技巧3: 添加新的快捷操作
在 `dashboard.html` 中添加:
```html
<div class="shortcut-card" onclick="yourFunction()">
    <div class="shortcut-icon">🎯</div>
    <div class="shortcut-title">自定义操作</div>
    <div class="shortcut-desc">操作说明</div>
</div>
```

在 `dashboard.js` 中实现:
```javascript
function yourFunction() {
    showNotification('执行自定义操作', 'info');
    // 你的逻辑
}
```

### 技巧4: 集成到现有工作流
将控制台URL添加到浏览器书签:
1. 启动dashboard
2. 访问 `http://localhost:8080/dashboard.html`
3. 添加到书签栏
4. 重命名为 "开发控制台"

## 🔄 维护与更新

### 定期维护
- [ ] 每周检查数据准确性
- [ ] 每月更新API地址
- [ ] 每季度优化界面
- [ ] 每半年大版本更新

### 版本记录
- **v1.0.0** (2025-10-03): 初始版本发布

### 更新日志
参见项目根目录的 `CHANGELOG.md`

## 📞 技术支持

### 文档资源
- 项目总览: `docs/00-项目总览.md`
- API文档: `docs/02-技术实现/API接口文档.md`
- 部署指南: `docs/04-部署与运维/`

### 联系方式
如有问题或建议:
1. 查看项目文档
2. 查看开发规范
3. 提交Issue到项目仓库

---

**文档版本**: v1.0.0
**最后更新**: 2025年10月3日
**维护团队**: 微信支付积分系统开发组

