# 积分管理后台功能规格说明书（FRD）

## 📖 文档信息
- **文档版本**：V1.0
- **创建日期**：2024年9月
- **产品经理**：产品开发团队
- **开发负责人**：技术开发团队
- **评审状态**：待评审

---

## 🎯 功能概述

### 管理后台定位
积分营销系统的统一管理中心，为平台运营、商户管理、财务监控提供专业的Web管理界面。

### 核心价值
1. **数据驱动决策**：实时数据分析支持业务决策
2. **运营效率提升**：自动化管理流程，减少人工操作
3. **风险管控**：实时监控异常数据，及时预警
4. **用户体验优化**：通过数据分析优化用户体验

---

## 🔐 用户角色和权限设计

### 角色定义

#### 1. 超级管理员 (Super Admin)
**角色代码**: `super_admin`
**权限范围**: 系统最高权限
**功能权限**:
```
✅ 用户管理: 查看、编辑、删除、积分调整
✅ 商户管理: 查看、审核、编辑、禁用
✅ 积分管理: 查看、配置、调整、统计
✅ 订单管理: 查看、退款、状态修改
✅ 财务管理: 查看、导出、统计分析
✅ 系统管理: 配置、日志、监控、备份
✅ 营销管理: 活动创建、规则配置
✅ 权限管理: 管理员账号、角色权限
```

#### 2. 运营管理员 (Operation Admin)
**角色代码**: `operation_admin`
**权限范围**: 业务运营权限
**功能权限**:
```
✅ 用户管理: 查看、编辑（限制删除）
✅ 商户管理: 查看、基础编辑
✅ 积分管理: 查看、统计、活动配置
✅ 订单管理: 查看、基础处理
❌ 财务管理: 仅查看权限
❌ 系统管理: 仅监控查看
✅ 营销管理: 活动创建、执行
❌ 权限管理: 无权限
```

#### 3. 商户管理员 (Merchant Admin)  
**角色代码**: `merchant_admin`
**权限范围**: 自身商户数据权限
**功能权限**:
```
✅ 自身数据: 交易查看、客户查看
✅ 积分数据: 自身积分发放统计
✅ 订单数据: 自身订单查看
❌ 其他商户: 无权限
❌ 用户管理: 无权限
❌ 系统管理: 无权限
❌ 财务管理: 无权限
```

#### 4. 财务管理员 (Finance Admin)
**角色代码**: `finance_admin`  
**权限范围**: 财务数据权限
**功能权限**:
```
✅ 财务数据: 查看、导出、统计
✅ 订单数据: 查看、退款审核
✅ 积分成本: 查看、分析
✅ 商户结算: 查看、处理
❌ 用户管理: 仅查看
❌ 商户管理: 仅查看
❌ 系统管理: 无权限
```

---

## 📊 核心功能模块详细设计

### 1. 仪表板模块 (Dashboard)

#### 1.1 数据概览区域
**布局**: 4×2 卡片布局
**数据指标**:
```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│  总用户数    │  活跃用户    │  总商户数    │  今日新增    │
│   10,234    │    8,567    │     156     │     23      │
│  ↗ +5.2%   │  ↗ +3.1%   │  ↗ +2.8%   │  ↘ -12%    │
└─────────────┴─────────────┴─────────────┴─────────────┘
┌─────────────┬─────────────┬─────────────┬─────────────┐
│  今日交易额  │  今日订单数  │  积分发放    │  平均客单价  │
│  ¥58,230   │    1,234    │   58,230   │   ¥47.2    │
│  ↗ +8.9%   │  ↗ +12.3%  │  ↗ +8.9%   │  ↘ -2.1%   │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

#### 1.2 趋势图表区域
**图表类型**: 折线图 + 柱状图组合
**数据维度**: 
- 近7日支付趋势
- 近7日积分发放趋势  
- 近7日用户增长趋势
- 商户活跃度分布

#### 1.3 实时监控区域
**监控项目**:
- API响应时间
- 系统错误率
- 数据库连接状态
- 服务器资源使用率

#### 1.4 待处理事项
**提醒内容**:
- 待审核商户申请
- 异常订单处理
- 积分异常预警
- 系统维护提醒

### 2. 用户管理模块

#### 2.1 用户列表页面
**页面路径**: `/admin/users`
**主要功能**:

**搜索筛选区**:
```
┌─────────────────────────────────────────────────────────┐
│ 搜索: [用户昵称/手机号/ID] [搜索按钮]                      │
│ 筛选: [注册时间▼] [用户状态▼] [积分范围▼] [最后活跃▼]      │
│ 操作: [批量操作▼] [导出Excel] [重置筛选]                  │
└─────────────────────────────────────────────────────────┘
```

**数据表格设计**:
| 字段 | 宽度 | 说明 | 排序 |
|------|------|------|------|
| 用户ID | 120px | 点击可复制 | ✅ |
| 头像昵称 | 200px | 头像+昵称组合 | ✅ |
| 手机号 | 120px | 脱敏显示 | ❌ |
| 积分余额 | 100px | 数字格式化 | ✅ |
| 累计消费 | 100px | 金额格式化 | ✅ |
| 注册时间 | 150px | 相对时间 | ✅ |
| 最后活跃 | 150px | 相对时间 | ✅ |
| 状态 | 80px | 状态标签 | ✅ |
| 操作 | 120px | 查看/编辑/禁用 | ❌ |

#### 2.2 用户详情页面
**页面路径**: `/admin/users/:id`
**布局结构**:

**基本信息卡片**:
```
┌─────────────────────────────────────────┐
│ 👤 用户基本信息                          │
├─────────────────────────────────────────┤
│ 头像: [用户头像]    昵称: 张三            │
│ 手机: 138****1234   微信ID: wx123456    │
│ 注册: 2024-01-15    状态: [活跃]        │
│ 最后活跃: 2024-12-20 14:30              │
└─────────────────────────────────────────┘
```

**积分账户卡片**:
```
┌─────────────────────────────────────────┐
│ 💰 积分账户信息                          │
├─────────────────────────────────────────┤
│ 当前余额: 1,234 积分                    │
│ 累计获得: 5,678 积分                    │
│ 累计消费: 4,444 积分                    │
│ 即将过期: 200 积分 (30天内)             │
│                                        │
│ [调整积分] [查看记录] [积分明细]         │
└─────────────────────────────────────────┘
```

**数据统计标签页**:
- **交易记录**: 支付订单列表，支持筛选
- **积分记录**: 积分变动明细，包含来源
- **行为分析**: 用户行为轨迹分析
- **操作日志**: 管理员对该用户的操作记录

### 3. 商户管理模块

#### 3.1 商户列表页面
**页面路径**: `/admin/merchants`

**状态分类标签**:
```
[全部(156)] [待审核(12)] [运营中(142)] [已禁用(2)]
```

**数据表格设计**:
| 字段 | 宽度 | 说明 | 操作 |
|------|------|------|------|
| 商户编号 | 120px | 自动生成 | 复制 |
| 商户名称 | 200px | 可点击查看详情 | 查看 |
| 联系人 | 100px | 姓名 | 查看 |
| 联系电话 | 120px | 可点击拨打 | 拨打 |
| 注册时间 | 150px | 格式化显示 | 排序 |
| 总交易额 | 120px | 金额格式化 | 排序 |
| 总订单数 | 100px | 数字格式化 | 排序 |
| 状态 | 100px | 状态标签 | 更改 |
| 操作 | 150px | 审核/编辑/禁用 | 操作 |

#### 3.2 商户审核页面
**页面路径**: `/admin/merchants/review`

**审核信息展示**:
```
┌─────────────────────────────────────────┐
│ 📋 商户申请信息                          │
├─────────────────────────────────────────┤
│ 商户名称: 小米便利店                     │
│ 法人代表: 张三                          │
│ 营业执照: [查看证件] 91110000000000001X  │
│ 联系电话: 138-0013-8001                 │
│ 经营地址: 北京市朝阳区...                │
│                                        │
│ 资质文件:                               │
│ [营业执照.jpg] [身份证正面.jpg]          │
│ [身份证反面.jpg] [银行开户许可证.pdf]     │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 审核操作                                │
├─────────────────────────────────────────┤
│ 审核结果: ○ 通过 ○ 拒绝                │
│ 审核意见: [文本框]                      │
│ 备注信息: [文本框]                      │
│                                        │
│ [提交审核] [保存草稿] [返回列表]         │
└─────────────────────────────────────────┘
```

#### 3.3 商户详情页面
**页面路径**: `/admin/merchants/:id`

**标签页结构**:
- **基本信息**: 商户基础信息展示和编辑
- **交易数据**: 交易统计和趋势图表
- **客户分析**: 客户构成和行为分析
- **收款码管理**: 二维码生成和管理
- **操作记录**: 管理员操作历史

### 4. 积分管理模块

#### 4.1 积分统计页面
**页面路径**: `/admin/points`

**顶部统计卡片**:
```
┌───────────┬───────────┬───────────┬───────────┐
│ 总积分池   │ 今日发放   │ 今日消费   │ 即将过期   │
│ 2,345,678 │  12,345   │   8,901   │   45,678  │
│   积分     │   积分     │   积分     │   积分    │
└───────────┴───────────┴───────────┴───────────┘
```

**图表分析区域**:
- **积分发放趋势图**: 近30天积分发放量
- **积分使用分布饼图**: 积分使用场景分析
- **商户积分排行**: TOP10积分发放商户

#### 4.2 积分规则配置页面
**页面路径**: `/admin/points/config`

**配置表单**:
```
┌─────────────────────────────────────────┐
│ ⚙️ 积分基础配置                          │
├─────────────────────────────────────────┤
│ 积分兑换比例: [1] 元 = [1] 积分          │
│ 积分有效期: [365] 天                    │
│ 单日最大获得: [10000] 积分               │
│ 单次最大调整: [1000] 积分                │
│                                        │
│ ⚙️ 高级配置                              │
│ 积分过期提醒: ☑ 启用 提前 [30] 天        │
│ 自动清理过期积分: ☑ 启用                 │
│ 积分冻结规则: ☑ 启用异常检测            │
│                                        │
│ [保存配置] [重置] [预览效果]             │
└─────────────────────────────────────────┘
```

#### 4.3 积分记录管理页面
**页面路径**: `/admin/points/records`

**筛选条件**:
```
时间范围: [2024-12-01] 至 [2024-12-31]
积分类型: [全部▼] [获得] [消费] [过期] [调整]
变化范围: 最少 [0] 积分 至 最多 [1000] 积分
用户筛选: [用户ID/昵称]
商户筛选: [商户名称]
```

**记录表格**:
| 时间 | 用户 | 商户 | 变化量 | 余额 | 来源 | 描述 | 操作 |
|------|------|------|--------|------|------|------|------|
| 12-20 14:30 | 张三 | 小米店 | +50 | 1,234 | 支付奖励 | 订单支付获得积分 | 查看 |
| 12-20 14:25 | 李四 | 星巴克 | -100 | 456 | 商城消费 | 兑换咖啡券 | 查看 |

### 5. 订单管理模块

#### 5.1 订单列表页面
**页面路径**: `/admin/orders`

**快速筛选标签**:
```
[全部] [待支付] [支付成功] [已取消] [退款中] [已退款]
```

**高级筛选**:
```
┌─────────────────────────────────────────────────────────┐
│ 时间范围: [选择日期] 至 [选择日期]                        │
│ 金额范围: ¥[0] 至 ¥[1000]                              │
│ 支付方式: [微信支付▼]                                   │
│ 商户筛选: [选择商户]                                    │
│ 用户筛选: [用户ID/昵称]                                 │
└─────────────────────────────────────────────────────────┘
```

#### 5.2 订单详情页面
**页面路径**: `/admin/orders/:id`

**订单信息卡片**:
```
┌─────────────────────────────────────────┐
│ 📄 订单信息                              │
├─────────────────────────────────────────┤
│ 订单号: 20241220143025123456             │
│ 创建时间: 2024-12-20 14:30:25           │
│ 支付时间: 2024-12-20 14:31:02           │
│ 订单状态: [支付成功]                     │
│ 支付金额: ¥58.00                       │
│ 积分奖励: 58 积分                       │
│                                        │
│ 用户信息: 张三 (138****1234)             │
│ 商户信息: 小米便利店                     │
│ 支付方式: 微信支付                       │
│ 微信订单号: 4200001234567890123          │
└─────────────────────────────────────────┘
```

**操作按钮区域**:
```
[退款申请] [修改状态] [发送通知] [打印订单]
```

### 6. 数据统计模块

#### 6.1 综合报表页面
**页面路径**: `/admin/reports`

**报表类型选择**:
```
┌─────────────────────────────────────────┐
│ 📊 报表类型                              │
├─────────────────────────────────────────┤
│ ○ 用户增长报表                          │
│ ○ 交易统计报表                          │
│ ○ 积分流水报表                          │
│ ○ 商户经营报表                          │
│ ○ 财务汇总报表                          │
│ ○ 自定义报表                            │
└─────────────────────────────────────────┘
```

**报表配置**:
```
时间维度: ○ 按日 ○ 按周 ○ 按月 ○ 自定义
时间范围: [2024-12-01] 至 [2024-12-31]
数据维度: ☑ 按商户 ☑ 按地区 ☑ 按用户等级
对比分析: ☑ 同比 ☑ 环比
导出格式: ○ Excel ○ PDF ○ CSV
```

#### 6.2 实时监控页面
**页面路径**: `/admin/monitor`

**监控面板布局**:
```
┌──────────────┬──────────────┐
│   系统状态    │   业务监控    │
│              │              │
│ - 服务器状态  │ - 支付成功率  │
│ - API响应    │ - 积分发放率  │
│ - 数据库     │ - 异常订单    │
│ - 缓存状态   │ - 用户活跃度  │
└──────────────┴──────────────┘
```

### 7. 系统设置模块

#### 7.1 系统配置页面
**页面路径**: `/admin/settings/system`

**配置分组**:
```
┌─────────────────────────────────────────┐
│ 🔧 基础配置                              │
├─────────────────────────────────────────┤
│ 系统名称: [积分营销管理系统]              │
│ 系统版本: [v1.0.0]                     │
│ 维护模式: ○ 开启 ● 关闭                 │
│ 调试模式: ○ 开启 ● 关闭                 │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 💳 支付配置                              │
├─────────────────────────────────────────┤
│ 微信AppID: [wx9bed12ef0904d035]          │
│ 商户号: [1727765161]                    │
│ API密钥: [••••••••••••••••••••••••••]    │
│ 回调地址: [https://api.guandongfang.cn...] │
└─────────────────────────────────────────┘
```

#### 7.2 管理员账号管理
**页面路径**: `/admin/settings/admins`

**账号列表**:
| 用户名 | 真实姓名 | 角色 | 状态 | 最后登录 | 操作 |
|--------|----------|------|------|----------|------|
| admin | 系统管理员 | 超级管理员 | 正常 | 2分钟前 | 编辑/禁用 |
| operator | 王运营 | 运营管理员 | 正常 | 1小时前 | 编辑/禁用 |

**添加管理员表单**:
```
┌─────────────────────────────────────────┐
│ ➕ 添加管理员                            │
├─────────────────────────────────────────┤
│ 用户名: [输入用户名]                     │
│ 密码: [输入密码]                        │
│ 确认密码: [确认密码]                     │
│ 真实姓名: [输入姓名]                     │
│ 邮箱: [输入邮箱]                        │
│ 手机号: [输入手机号]                     │
│ 角色: [选择角色▼]                       │
│                                        │
│ [确认添加] [重置] [取消]                 │
└─────────────────────────────────────────┘
```

---

## 🎨 页面交互规范

### 通用交互规范

#### 1. 加载状态
- **页面加载**: 骨架屏 + 进度条
- **数据加载**: 表格/图表loading状态
- **按钮操作**: 按钮disabled + loading图标
- **文件上传**: 进度条 + 百分比显示

#### 2. 错误处理
- **网络错误**: 全局错误提示 + 重试机制
- **权限错误**: 403页面 + 返回按钮
- **数据错误**: 字段级错误提示
- **系统错误**: 500页面 + 联系技术支持

#### 3. 成功反馈
- **操作成功**: 右上角成功提示(3秒自动消失)
- **数据保存**: 按钮状态变化 + 提示文字
- **批量操作**: 进度条 + 成功失败统计

### 专用交互规范

#### 1. 数据表格
- **排序**: 点击表头排序，显示排序图标
- **筛选**: 支持多条件组合筛选
- **分页**: 每页20/50/100条可选
- **选择**: 支持单选/多选/全选
- **操作**: 悬停显示操作按钮

#### 2. 表单验证
- **实时验证**: 失去焦点时验证
- **提交验证**: 提交前全表单验证
- **错误显示**: 字段下方红色提示
- **必填标识**: 字段标签红色星号

#### 3. 图表交互
- **数据点**: 悬停显示详细数据
- **图例**: 点击显示/隐藏数据系列
- **缩放**: 支持时间范围缩放
- **导出**: 支持图片/PDF导出

---

## 📱 响应式设计

### 屏幕适配
- **桌面端**: ≥1200px，完整功能展示
- **平板端**: 768px-1199px，侧边栏收缩
- **手机端**: <768px，抽屉式导航

### 关键页面移动端适配
1. **仪表板**: 卡片垂直堆叠，图表简化
2. **列表页**: 卡片式布局替代表格
3. **详情页**: 标签页垂直展示
4. **表单页**: 字段垂直排列，按钮全宽

---

## 🚀 开发实施计划

### 技术实施路径

#### Phase 1: 基础架构搭建
**时间**: 2周
**交付物**:
- [ ] 前端项目脚手架
- [ ] 后端API路由扩展
- [ ] 数据库表结构
- [ ] 基础认证系统

#### Phase 2: 核心页面开发
**时间**: 4周  
**交付物**:
- [ ] 登录页面
- [ ] 仪表板页面
- [ ] 用户管理页面
- [ ] 商户管理页面

#### Phase 3: 业务功能完善
**时间**: 3周
**交付物**:
- [ ] 积分管理功能
- [ ] 订单管理功能
- [ ] 数据统计报表
- [ ] 权限管理功能

#### Phase 4: 优化和部署
**时间**: 1周
**交付物**:
- [ ] 性能优化
- [ ] 测试验收
- [ ] 生产环境部署
- [ ] 用户培训文档

### 技术里程碑检查点

#### 检查点1: 架构验证
- [ ] 前后端通信正常
- [ ] 认证授权流程通过
- [ ] 数据库设计评审通过
- [ ] 核心组件开发完成

#### 检查点2: 功能完整性
- [ ] 所有页面开发完成
- [ ] 业务逻辑测试通过
- [ ] 权限控制验证通过
- [ ] 数据统计准确性验证

#### 检查点3: 生产就绪
- [ ] 性能测试通过
- [ ] 安全测试通过
- [ ] 兼容性测试通过
- [ ] 部署流程验证通过

---

## 📊 质量保证

### 代码质量标准
- **TypeScript覆盖率**: 100%
- **ESLint规则**: 严格模式，0 warnings
- **代码审查**: 所有PR必须经过Code Review
- **单元测试覆盖率**: 核心业务逻辑≥80%

### 性能要求
- **首屏加载**: ≤3秒
- **页面切换**: ≤1秒
- **数据查询**: ≤500ms
- **大数据表格**: 支持虚拟滚动

### 安全要求
- **HTTPS部署**: 全站HTTPS
- **XSS防护**: 所有输入输出过滤
- **CSRF防护**: Token验证
- **SQL注入防护**: 参数化查询

---

**文档状态**: 待技术评审  
**下一步行动**: 开始前端脚手架搭建  
**责任人**: 技术负责人  
**评审时间**: 本周内
