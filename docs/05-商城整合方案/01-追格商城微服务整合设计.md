# è¿½æ ¼ç§¯åˆ†å•†åŸå¾®æœåŠ¡æ¶æ„æ•´åˆæ–¹æ¡ˆ

## ğŸ“– æ–‡æ¡£ä¿¡æ¯
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šV1.0
- **åˆ›å»ºæ—¥æœŸ**ï¼š2024å¹´9æœˆ24æ—¥
- **äº§å“ç»ç†**ï¼šäº§å“å›¢é˜Ÿ
- **æ¶æ„å¸ˆ**ï¼šæŠ€æœ¯å›¢é˜Ÿ
- **è¯„å®¡çŠ¶æ€**ï¼šå¾…è¯„å®¡

---

## ğŸ¯ æ•´åˆç›®æ ‡

å°†è¿½æ ¼ç§¯åˆ†å•†åŸå°ç¨‹åºåŠŸèƒ½æ•´åˆåˆ°ç°æœ‰å¾®ä¿¡æ”¯ä»˜ç§¯åˆ†ç³»ç»Ÿä¸­ï¼Œå½¢æˆå®Œæ•´çš„"æ”¯ä»˜è·å¾—ç§¯åˆ† â†’ ç§¯åˆ†å•†åŸæ¶ˆè´¹"é—­ç¯ç”Ÿæ€ã€‚

### æ ¸å¿ƒæ•´åˆåŸåˆ™
1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå•†åŸåŠŸèƒ½ä½œä¸ºç‹¬ç«‹å¾®æœåŠ¡æ¨¡å—
2. **æ•°æ®ç»Ÿä¸€**ï¼šå…±äº«ç”¨æˆ·ä½“ç³»å’Œç§¯åˆ†ä½“ç³»
3. **ä½“éªŒæ— ç¼**ï¼šæ”¯ä»˜ä¸å•†åŸåŠŸèƒ½æ— ç¼å¯¹æ¥
4. **æ¶æ„å…¼å®¹**ï¼šå¤ç”¨ç°æœ‰æŠ€æœ¯æ ˆå’ŒåŸºç¡€è®¾æ–½

---

## ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„æ‰©å±•è®¾è®¡

### æ–°å¢å¾®æœåŠ¡æ¨¡å—

```
ç°æœ‰æ¶æ„ + å•†åŸæ¨¡å—æ‰©å±•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Gateway                        â”‚
â”‚              (è·¯ç”±ã€é‰´æƒã€é™æµã€ç›‘æ§)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              |
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                 â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ç°æœ‰æœåŠ¡ç¾¤    â”‚ â”‚   å•†åŸæœåŠ¡ç¾¤    â”‚ â”‚   å…±äº«æœåŠ¡ç¾¤    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç”¨æˆ·æœåŠ¡       â”‚ â”‚ å•†å“æœåŠ¡       â”‚ â”‚ é€šçŸ¥æœåŠ¡       â”‚
    â”‚ æ”¯ä»˜æœåŠ¡       â”‚ â”‚ è®¢å•æœåŠ¡       â”‚ â”‚ ç»Ÿè®¡æœåŠ¡       â”‚
    â”‚ ç§¯åˆ†æœåŠ¡       â”‚ â”‚ åº“å­˜æœåŠ¡       â”‚ â”‚ é…ç½®æœåŠ¡       â”‚
    â”‚ å•†æˆ·æœåŠ¡       â”‚ â”‚ å…‘æ¢æœåŠ¡       â”‚ â”‚ æ–‡ä»¶æœåŠ¡       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°å¢æœåŠ¡è¯¦ç»†è®¾è®¡

#### 1. å•†å“æœåŠ¡ (Product Service)
```typescript
interface ProductService {
  // å•†å“ç®¡ç†
  createProduct(product: CreateProductDto): Promise<ProductEntity>
  updateProduct(id: string, product: UpdateProductDto): Promise<boolean>
  deleteProduct(id: string): Promise<boolean>
  
  // å•†å“æŸ¥è¯¢
  getProducts(filter: ProductFilter): Promise<ProductList>
  getProductDetail(id: string): Promise<ProductEntity>
  searchProducts(keyword: string): Promise<ProductEntity[]>
  
  // åˆ†ç±»ç®¡ç†
  getCategories(): Promise<CategoryEntity[]>
  getProductsByCategory(categoryId: string): Promise<ProductEntity[]>
  
  // æ¨èç³»ç»Ÿ
  getRecommendedProducts(userId: string, context: RecommendContext): Promise<ProductEntity[]>
}
```

#### 2. å…‘æ¢æœåŠ¡ (Exchange Service)
```typescript
interface ExchangeService {
  // å…‘æ¢å¤„ç†
  createExchangeOrder(userId: string, productId: string, quantity: number): Promise<ExchangeOrder>
  confirmExchange(orderId: string): Promise<ExchangeResult>
  cancelExchange(orderId: string): Promise<boolean>
  
  // è®¢å•æŸ¥è¯¢
  getExchangeOrders(userId: string, status?: ExchangeStatus): Promise<ExchangeOrder[]>
  getExchangeOrderDetail(orderId: string): Promise<ExchangeOrder>
  
  // å‘è´§ç®¡ç†
  updateDeliveryStatus(orderId: string, status: DeliveryStatus): Promise<boolean>
  trackDelivery(orderId: string): Promise<DeliveryInfo>
}
```

#### 3. åº“å­˜æœåŠ¡ (Inventory Service)
```typescript
interface InventoryService {
  // åº“å­˜ç®¡ç†
  checkStock(productId: string, quantity: number): Promise<boolean>
  reserveStock(productId: string, quantity: number, orderId: string): Promise<boolean>
  releaseStock(productId: string, quantity: number, orderId: string): Promise<boolean>
  updateStock(productId: string, quantity: number): Promise<boolean>
  
  // åº“å­˜æŸ¥è¯¢
  getStockLevel(productId: string): Promise<StockInfo>
  getLowStockProducts(): Promise<ProductEntity[]>
  
  // åº“å­˜é¢„è­¦
  setStockAlert(productId: string, threshold: number): Promise<boolean>
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“æ‰©å±•è®¾è®¡

### æ–°å¢æ•°æ®è¡¨

#### å•†å“è¡¨ (products)
```sql
CREATE TABLE products (
  id VARCHAR(36) PRIMARY KEY,
  name VARCHAR(200) NOT NULL,
  description TEXT,
  category_id VARCHAR(36) NOT NULL,
  points_price INT NOT NULL,
  original_price DECIMAL(10,2),
  stock_quantity INT DEFAULT 0,
  sales_count INT DEFAULT 0,
  images JSON,
  specifications JSON,
  is_hot BOOLEAN DEFAULT FALSE,
  is_new BOOLEAN DEFAULT FALSE,
  status TINYINT DEFAULT 1,
  sort_order INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_category_id (category_id),
  INDEX idx_points_price (points_price),
  INDEX idx_status (status),
  INDEX idx_is_hot (is_hot),
  INDEX idx_sales_count (sales_count)
);
```

#### å•†å“åˆ†ç±»è¡¨ (product_categories)
```sql
CREATE TABLE product_categories (
  id VARCHAR(36) PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  icon VARCHAR(500),
  parent_id VARCHAR(36),
  level INT DEFAULT 1,
  sort_order INT DEFAULT 0,
  status TINYINT DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_parent_id (parent_id),
  INDEX idx_level (level),
  INDEX idx_sort_order (sort_order)
);
```

#### å…‘æ¢è®¢å•è¡¨ (exchange_orders)
```sql
CREATE TABLE exchange_orders (
  id VARCHAR(36) PRIMARY KEY,
  order_no VARCHAR(32) UNIQUE NOT NULL,
  user_id VARCHAR(36) NOT NULL,
  product_id VARCHAR(36) NOT NULL,
  product_name VARCHAR(200) NOT NULL,
  quantity INT NOT NULL,
  points_cost INT NOT NULL,
  status TINYINT DEFAULT 0,
  delivery_info JSON,
  tracking_no VARCHAR(100),
  delivery_status TINYINT DEFAULT 0,
  exchanged_at TIMESTAMP NULL,
  delivered_at TIMESTAMP NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_order_no (order_no),
  INDEX idx_user_id (user_id),
  INDEX idx_product_id (product_id),
  INDEX idx_status (status),
  INDEX idx_created_at (created_at)
);
```

#### åº“å­˜è®°å½•è¡¨ (inventory_records)
```sql
CREATE TABLE inventory_records (
  id VARCHAR(36) PRIMARY KEY,
  product_id VARCHAR(36) NOT NULL,
  change_type TINYINT NOT NULL, -- 1:å…¥åº“ 2:å‡ºåº“ 3:é¢„ç•™ 4:é‡Šæ”¾
  quantity_change INT NOT NULL,
  stock_after INT NOT NULL,
  related_order_id VARCHAR(36),
  operator_id VARCHAR(36),
  description VARCHAR(200),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_product_id (product_id),
  INDEX idx_change_type (change_type),
  INDEX idx_related_order_id (related_order_id),
  INDEX idx_created_at (created_at)
);
```

---

## ğŸ”„ æœåŠ¡é—´äº¤äº’è®¾è®¡

### ç§¯åˆ†æœåŠ¡æ‰©å±•

ç°æœ‰ç§¯åˆ†æœåŠ¡å·²ç»é¢„ç•™äº†`consumePoints`æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•ä»¥æ”¯æŒå•†åŸå…‘æ¢ï¼š

```typescript
// æ‰©å±•ç°æœ‰ PointsService
export class PointsService {
  // ç°æœ‰æ–¹æ³•ä¿æŒä¸å˜...
  
  /**
   * å•†åŸå…‘æ¢ç§¯åˆ†æ¶ˆè´¹ï¼ˆäº‹åŠ¡ä¿è¯ï¼‰
   */
  static async exchangePoints(
    userId: string,
    productId: string,
    pointsCost: number,
    exchangeOrderId: string
  ): Promise<ExchangeResult> {
    if (pointsCost <= 0) {
      throw new Error('å…‘æ¢ç§¯åˆ†æ•°é‡å¿…é¡»å¤§äº0')
    }
    
    const connection = await getDBConnection()
    await connection.beginTransaction()
    
    try {
      // 1. æ£€æŸ¥ç§¯åˆ†ä½™é¢
      const user = await UserModel.findById(userId)
      if (!user || user.pointsBalance < pointsCost) {
        throw new Error('ç§¯åˆ†ä½™é¢ä¸è¶³')
      }
      
      // 2. æ£€æŸ¥å•†å“åº“å­˜
      const stockAvailable = await InventoryService.checkStock(productId, 1)
      if (!stockAvailable) {
        throw new Error('å•†å“åº“å­˜ä¸è¶³')
      }
      
      // 3. é¢„ç•™åº“å­˜
      await InventoryService.reserveStock(productId, 1, exchangeOrderId)
      
      // 4. æ‰£å‡ç§¯åˆ†
      await this.consumePoints(userId, pointsCost, `å•†åŸå…‘æ¢-${productId}`, exchangeOrderId)
      
      // 5. åˆ›å»ºå…‘æ¢è®¢å•
      const exchangeOrder = await ExchangeService.createExchangeOrder({
        userId,
        productId,
        pointsCost,
        quantity: 1
      })
      
      await connection.commit()
      
      return {
        success: true,
        exchangeOrderId: exchangeOrder.id,
        remainingPoints: user.pointsBalance - pointsCost,
        estimatedDelivery: exchangeOrder.estimatedDelivery
      }
      
    } catch (error) {
      await connection.rollback()
      throw error
    }
  }
}
```

### è·¨æœåŠ¡äº‹ä»¶é€šä¿¡

```typescript
// äº‹ä»¶é©±åŠ¨é€šä¿¡æœºåˆ¶
interface ServiceEvent {
  eventId: string
  eventType: string
  source: string
  target: string[]
  payload: any
  timestamp: Date
}

// äº‹ä»¶ç±»å‹å®šä¹‰
enum EventType {
  // æ”¯ä»˜ç›¸å…³
  PAYMENT_SUCCESS = 'payment.success',
  PAYMENT_FAILED = 'payment.failed',
  
  // ç§¯åˆ†ç›¸å…³
  POINTS_AWARDED = 'points.awarded',
  POINTS_CONSUMED = 'points.consumed',
  
  // å•†åŸç›¸å…³
  PRODUCT_EXCHANGED = 'mall.product.exchanged',
  INVENTORY_LOW = 'mall.inventory.low',
  ORDER_DELIVERED = 'mall.order.delivered'
}

// äº‹ä»¶å¤„ç†å™¨
class EventHandler {
  // æ”¯ä»˜æˆåŠŸåçš„äº‹ä»¶å¤„ç†
  async onPaymentSuccess(event: ServiceEvent) {
    const { userId, amount, orderId } = event.payload
    
    // 1. å‘æ”¾ç§¯åˆ†
    await PointsService.awardPoints(userId, amount, 'payment_reward', 'æ”¯ä»˜å¥–åŠ±', orderId)
    
    // 2. æ›´æ–°ç”¨æˆ·æ¨è
    await RecommendationService.updateUserRecommendations(userId)
    
    // 3. å‘é€é€šçŸ¥
    await NotificationService.sendPointsAwardNotification(userId, amount)
  }
  
  // ç§¯åˆ†å…‘æ¢åçš„äº‹ä»¶å¤„ç†
  async onProductExchanged(event: ServiceEvent) {
    const { userId, productId, pointsCost } = event.payload
    
    // 1. æ›´æ–°ç”¨æˆ·ç”»åƒ
    await UserProfileService.updateExchangePreference(userId, productId)
    
    // 2. æ›´æ–°æ¨èç®—æ³•
    await RecommendationService.updateRecommendations(userId)
    
    // 3. å‘é€å…‘æ¢æˆåŠŸé€šçŸ¥
    await NotificationService.sendExchangeSuccessNotification(userId, productId)
  }
}
```

---

## ğŸ“± å‰ç«¯æ¶æ„æ•´åˆ

### å°ç¨‹åºé¡µé¢ç»“æ„æ‰©å±•

```json
// app.json æ‰©å±•
{
  "pages": [
    // ç°æœ‰é¡µé¢
    "pages/points/index",
    "pages/payment/index", 
    "pages/payment/history",
    "pages/points/history",
    "pages/profile/index",
    
    // æ–°å¢å•†åŸé¡µé¢
    "pages/mall/index",
    "pages/mall/category",
    "pages/mall/product-detail",
    "pages/mall/exchange-confirm",
    "pages/mall/exchange-success",
    "pages/mall/order-list",
    "pages/mall/order-detail"
  ],
  "subPackages": [
    {
      "root": "mall-package",
      "name": "mall",
      "pages": [
        "pages/index",
        "pages/category", 
        "pages/product-detail",
        "pages/exchange-confirm",
        "pages/exchange-success",
        "pages/order-list",
        "pages/order-detail"
      ]
    }
  ],
  "tabBar": {
    "list": [
      {
        "pagePath": "pages/points/index",
        "text": "ç§¯åˆ†"
      },
      {
        "pagePath": "pages/mall/index", 
        "text": "å•†åŸ"
      },
      {
        "pagePath": "pages/profile/index",
        "text": "æˆ‘çš„"
      }
    ]
  }
}
```

### æ”¯ä»˜é¡µé¢å•†åŸåŠŸèƒ½æ•´åˆ

ä¿®æ”¹ç°æœ‰æ”¯ä»˜é¡µé¢ï¼Œæ·»åŠ å•†åŸé¢„å‘ŠåŠŸèƒ½ï¼š

```javascript
// pages/payment/index.js æ‰©å±•
Page({
  data: {
    // ç°æœ‰æ•°æ®...
    
    // å•†åŸç›¸å…³æ•°æ®
    recommendedProducts: [],
    showMallPreview: false,
    mallPreviewLoading: false
  },

  async onLoad(options) {
    // ç°æœ‰é€»è¾‘...
    
    // åŠ è½½å•†åŸæ¨èå•†å“
    await this.loadMallRecommendations()
  },

  /**
   * åŠ è½½å•†åŸæ¨èå•†å“
   */
  async loadMallRecommendations() {
    try {
      this.setData({ mallPreviewLoading: true })
      
      const userPoints = await PointsService.getPointsBalance()
      const expectedPoints = Math.floor(this.data.amount / 100)
      
      const recommendations = await MallService.getPaymentRecommendations({
        currentPoints: userPoints.balance,
        expectedPoints: expectedPoints,
        limit: 3
      })
      
      this.setData({
        recommendedProducts: recommendations,
        showMallPreview: recommendations.length > 0,
        mallPreviewLoading: false
      })
    } catch (error) {
      console.error('åŠ è½½å•†åŸæ¨èå¤±è´¥:', error)
      this.setData({ mallPreviewLoading: false })
    }
  },

  /**
   * è·³è½¬åˆ°å•†åŸ
   */
  navigateToMall() {
    wx.navigateTo({
      url: `/mall-package/pages/index/index?source=payment_preview&expected_points=${Math.floor(this.data.amount / 100)}`
    })
  },

  /**
   * æŸ¥çœ‹æ¨èå•†å“è¯¦æƒ…
   */
  viewProductDetail(e) {
    const productId = e.currentTarget.dataset.productId
    wx.navigateTo({
      url: `/mall-package/pages/product-detail/index?id=${productId}&source=payment_preview`
    })
  }
})
```

---

## ğŸ”Œ APIæ¥å£è®¾è®¡

### å•†åŸæœåŠ¡APIæ¥å£

```typescript
// å•†åŸç›¸å…³APIæ¥å£
const MallAPIRoutes = {
  // å•†å“ç›¸å…³
  'GET /api/mall/products': 'ProductController.getProducts',
  'GET /api/mall/products/:id': 'ProductController.getProductDetail', 
  'GET /api/mall/categories': 'ProductController.getCategories',
  'GET /api/mall/search': 'ProductController.searchProducts',
  
  // æ¨èç›¸å…³
  'GET /api/mall/recommendations': 'RecommendationController.getRecommendations',
  'POST /api/mall/recommendations/refresh': 'RecommendationController.refreshRecommendations',
  
  // å…‘æ¢ç›¸å…³
  'POST /api/mall/exchange': 'ExchangeController.createExchange',
  'GET /api/mall/exchange/orders': 'ExchangeController.getExchangeOrders',
  'GET /api/mall/exchange/orders/:id': 'ExchangeController.getExchangeOrderDetail',
  'POST /api/mall/exchange/orders/:id/cancel': 'ExchangeController.cancelExchange',
  
  // åº“å­˜ç›¸å…³
  'GET /api/mall/inventory/:productId': 'InventoryController.getStock',
  'POST /api/mall/inventory/check': 'InventoryController.checkMultipleStock'
}
```

### æ¥å£æ•°æ®æ ¼å¼

```typescript
// å•†å“ä¿¡æ¯æ¥å£
interface ProductResponse {
  id: string
  name: string
  description: string
  category: {
    id: string
    name: string
  }
  pointsPrice: number
  originalPrice: number
  images: string[]
  specifications: any
  stockQuantity: number
  salesCount: number
  isHot: boolean
  isNew: boolean
  status: number
}

// å…‘æ¢è®¢å•æ¥å£
interface ExchangeOrderResponse {
  id: string
  orderNo: string
  userId: string
  product: ProductResponse
  quantity: number
  pointsCost: number
  status: ExchangeOrderStatus
  deliveryInfo: {
    receiverName: string
    receiverPhone: string
    address: string
    trackingNo?: string
  }
  exchangedAt?: Date
  estimatedDelivery?: Date
  deliveredAt?: Date
}
```

---

## ğŸš€ éƒ¨ç½²å’Œé›†æˆç­–ç•¥

### 1. åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

#### Phase 1: åŸºç¡€æ¶æ„æ­å»º (Week 1-2)
- [ ] å•†åŸå¾®æœåŠ¡æ¡†æ¶æ­å»º
- [ ] æ•°æ®åº“è¡¨ç»“æ„åˆ›å»º
- [ ] åŸºç¡€APIæ¥å£å¼€å‘
- [ ] å‰ç«¯å•†åŸé¡µé¢åŸºç¡€æ¡†æ¶

#### Phase 2: æ ¸å¿ƒåŠŸèƒ½å¼€å‘ (Week 3-4)  
- [ ] å•†å“ç®¡ç†åŠŸèƒ½å®Œæˆ
- [ ] å…‘æ¢æµç¨‹å®Œæ•´å®ç°
- [ ] åº“å­˜ç®¡ç†ç³»ç»Ÿ
- [ ] æ¨èç®—æ³•åˆç‰ˆ

#### Phase 3: ç³»ç»Ÿæ•´åˆ (Week 5-6)
- [ ] æ”¯ä»˜é¡µé¢å•†åŸåŠŸèƒ½é›†æˆ
- [ ] ç§¯åˆ†æœåŠ¡å•†åŸæ¶ˆè´¹å¯¹æ¥
- [ ] ç”¨æˆ·çŠ¶æ€ç»Ÿä¸€ç®¡ç†
- [ ] è·¨æœåŠ¡äº‹ä»¶é€šä¿¡

#### Phase 4: ä¼˜åŒ–ä¸Šçº¿ (Week 7-8)
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œå‹åŠ›æµ‹è¯•
- [ ] UI/UXä¼˜åŒ–å®Œå–„
- [ ] ç›‘æ§å’Œæ—¥å¿—å®Œå–„
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 2. æŠ€æœ¯é£é™©æ§åˆ¶

#### æ•°æ®ä¸€è‡´æ€§ä¿è¯
```typescript
// åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†
class DistributedTransaction {
  async executeExchangeTransaction(exchangeData: ExchangeTransactionData) {
    const sagaSteps = [
      // Step 1: æ£€æŸ¥ç§¯åˆ†ä½™é¢
      {
        service: 'PointsService',
        action: 'checkBalance',
        compensate: null
      },
      // Step 2: æ£€æŸ¥åº“å­˜
      {
        service: 'InventoryService', 
        action: 'checkAndReserveStock',
        compensate: 'releaseStock'
      },
      // Step 3: æ‰£å‡ç§¯åˆ†
      {
        service: 'PointsService',
        action: 'consumePoints',
        compensate: 'refundPoints'
      },
      // Step 4: åˆ›å»ºå…‘æ¢è®¢å•
      {
        service: 'ExchangeService',
        action: 'createOrder',
        compensate: 'cancelOrder'
      }
    ]
    
    return await this.executeSaga(sagaSteps, exchangeData)
  }
}
```

### 3. ç›‘æ§å’Œè¿ç»´

#### æ–°å¢ç›‘æ§æŒ‡æ ‡
```typescript
const MallServiceMetrics = {
  // å•†åŸä¸šåŠ¡æŒ‡æ ‡
  business: {
    productViewRate: 'å•†å“æµè§ˆç‡',
    exchangeConversionRate: 'å…‘æ¢è½¬åŒ–ç‡', 
    averageExchangeValue: 'å¹³å‡å…‘æ¢ç§¯åˆ†',
    inventoryTurnover: 'åº“å­˜å‘¨è½¬ç‡',
    userReturnRate: 'ç”¨æˆ·å›è®¿ç‡'
  },
  
  // æŠ€æœ¯æŒ‡æ ‡
  technical: {
    apiResponseTime: 'APIå“åº”æ—¶é—´',
    serviceAvailability: 'æœåŠ¡å¯ç”¨æ€§',
    databasePerformance: 'æ•°æ®åº“æ€§èƒ½',
    cacheHitRate: 'ç¼“å­˜å‘½ä¸­ç‡'
  }
}
```

---

## ğŸ’» å®æ–½å»ºè®®

### å³æ—¶è¡ŒåŠ¨æ–¹æ¡ˆ

1. **ç«‹å³å¼€å§‹åŸºç¡€æ¶æ„æ­å»º**
   - åœ¨ç°æœ‰backendç›®å½•ä¸‹åˆ›å»ºå•†åŸæœåŠ¡æ¨¡å—
   - å¤ç”¨ç°æœ‰çš„æ•°æ®åº“è¿æ¥å’Œé…ç½®
   - æ‰©å±•ç°æœ‰çš„JWTè®¤è¯ä½“ç³»

2. **å‰ç«¯åˆ†åŒ…ä¼˜åŒ–**
   - å°†å•†åŸåŠŸèƒ½ä½œä¸ºç‹¬ç«‹åˆ†åŒ…
   - ä¿æŒä¸»åŒ…è½»é‡ï¼Œæå‡åŠ è½½é€Ÿåº¦
   - å¤ç”¨ç°æœ‰çš„æœåŠ¡å±‚å’Œå·¥å…·å‡½æ•°

3. **æ•°æ®åº“å¹³æ»‘æ‰©å±•**
   - åœ¨ç°æœ‰æ•°æ®åº“ä¸­æ–°å¢å•†åŸç›¸å…³è¡¨
   - æ‰©å±•ç°æœ‰ç§¯åˆ†è®°å½•è¡¨æ”¯æŒå•†åŸæ¶ˆè´¹ç±»å‹
   - ä¿æŒæ•°æ®ä¸€è‡´æ€§å’Œäº‹åŠ¡å®Œæ•´æ€§

4. **APIæ¥å£ç»Ÿä¸€ç®¡ç†**
   - å¤ç”¨ç°æœ‰çš„Expressè·¯ç”±ç»“æ„
   - ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå‚æ•°éªŒè¯
   - ä¿æŒæ¥å£é£æ ¼ä¸€è‡´æ€§

### æŠ€æœ¯å†³ç­–å»ºè®®

1. **ä¸å»ºè®®ç›´æ¥å¼•å…¥è¿½æ ¼æºç **
   - æŠ€æœ¯æ ˆå¯èƒ½ä¸åŒ¹é…
   - ä»£ç é£æ ¼å·®å¼‚è¾ƒå¤§
   - å®‰å…¨å’Œè´¨é‡éš¾ä»¥ä¿è¯

2. **å»ºè®®è‡ªä¸»å¼€å‘å•†åŸåŠŸèƒ½**
   - å®Œå…¨è´´åˆç°æœ‰æ¶æ„
   - ä¿è¯ä»£ç è´¨é‡å’Œå®‰å…¨æ€§
   - ä¾¿äºåç»­ç»´æŠ¤å’Œæ‰©å±•

3. **å¯å‚è€ƒè¿½æ ¼çš„ä¸šåŠ¡é€»è¾‘**
   - å­¦ä¹ å…¶å•†åŸåŠŸèƒ½è®¾è®¡
   - å€Ÿé‰´ç”¨æˆ·ä½“éªŒä¼˜åŒ–
   - å‚è€ƒæ¨èç®—æ³•æ€è·¯

---

## ğŸ“‹ æ€»ç»“å’Œä¸‹ä¸€æ­¥è¡ŒåŠ¨

### æ ¸å¿ƒä¼˜åŠ¿
1. **æ¶æ„å…¼å®¹**ï¼šå®Œå…¨åŸºäºç°æœ‰æŠ€æœ¯æ ˆæ‰©å±•
2. **å¼€å‘æ•ˆç‡**ï¼šå¤ç”¨ç°æœ‰åŸºç¡€è®¾æ–½å’Œå·¥å…·
3. **æ•°æ®ç»Ÿä¸€**ï¼šå…±äº«ç”¨æˆ·å’Œç§¯åˆ†ä½“ç³»
4. **ä½“éªŒè¿è´¯**ï¼šæ”¯ä»˜ä¸å•†åŸæ— ç¼å¯¹æ¥

### ç«‹å³è¡ŒåŠ¨é¡¹
1. åˆ›å»ºå•†åŸå¾®æœåŠ¡åŸºç¡€æ¡†æ¶
2. è®¾è®¡å•†åŸæ•°æ®è¡¨ç»“æ„
3. å¼€å‘æ ¸å¿ƒå•†åŸAPIæ¥å£
4. æ­å»ºå‰ç«¯å•†åŸé¡µé¢æ¡†æ¶

è¿™ä¸ªæ–¹æ¡ˆç¡®ä¿äº†å•†åŸåŠŸèƒ½ä¸ç°æœ‰ç³»ç»Ÿçš„å®Œç¾èåˆï¼Œæ—¢ä¿æŒäº†æ¶æ„çš„ä¸€è‡´æ€§ï¼Œåˆä¸ºä¸šåŠ¡æ‰©å±•æä¾›äº†åšå®åŸºç¡€ã€‚

æ‚¨è§‰å¾—è¿™ä¸ªæ•´åˆæ–¹æ¡ˆå¦‚ä½•ï¼Ÿæ˜¯å¦éœ€è¦æˆ‘ç«‹å³å¼€å§‹å®æ–½æŸä¸ªå…·ä½“æ¨¡å—ï¼Ÿ
