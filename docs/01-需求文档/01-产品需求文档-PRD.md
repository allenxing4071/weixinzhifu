# 积分赠送小程序产品需求文档（PRD）

## 📖 文档信息
- **文档版本**：V2.0（实际实施版本）
- **创建日期**：2025年9月24日
- **最后更新**：2025年9月30日
- **评审状态**：已完成实施
- **上线时间**：2025年9月26日（管理后台已上线）

---

## 🎯 产品概述

### 产品背景
基于微信支付合作伙伴总商家号，为下级商户提供积分赠送服务，用户通过扫码支付后自动获得1:1积分奖励，积分可在积分商城消费，形成完整的用户激励闭环。

### 产品目标
1. **用户目标**：支付即获得积分，增强消费体验和忠诚度
2. **商户目标**：通过积分激励提升客户粘性和复购率
3. **平台目标**：构建积分生态，增加交易量和用户活跃度

### 产品定位
面向B2B2C市场的积分营销工具，帮助商户通过积分激励提升用户价值。

### 商业模式明确

#### 平台角色定位
- **总平台身份**：微信支付合作伙伴/服务商
- **服务对象**：多个下级商户（小米便利店、星巴克等）
- **核心能力**：统一积分系统 + 多商户支付服务

#### 资金流向设计
- **用户支付** → **直接进入商户A账户**（微信支付账户）
- **积分成本** → **由总平台承担**（不向商户收取积分成本）
- **商户收益** → **100%收款金额** + **客户积分激励价值**

#### 技术依赖关系
- **二维码生成**：微信支付合作伙伴平台API
- **支付处理**：微信支付官方渠道
- **积分系统**：总平台自建系统
- **小程序载体**：总平台统一小程序

---

## 👥 目标用户

### 主要用户群体

#### 1. 终端消费用户
- **用户画像**：18-45岁，有移动支付习惯的消费者
- **使用场景**：餐厅用餐、零售购物、服务消费
- **核心需求**：支付便捷、获得实惠、积分兑换

#### 2. 商户经营者
- **用户画像**：中小型实体商户、连锁店管理者
- **使用场景**：日常收款、客户管理、营销活动
- **核心需求**：增加客流、提升复购、降低获客成本

#### 3. 总商家号管理员
- **用户画像**：平台运营人员、技术管理人员
- **使用场景**：商户管理、积分规则配置、数据分析
- **核心需求**：平台管控、数据监控、收益管理

---

## 🔧 功能需求

### 1. 用户端小程序功能

#### 1.1 用户注册登录 ✅ **已实现**
**功能描述**：用户通过微信授权快速注册登录

**已实现功能**：
- [x] 微信授权登录（wx.login + wx.getUserProfile）
- [x] 获取用户头像、昵称
- [x] Token本地存储和自动登录
- [ ] 用户协议和隐私政策确认（待实现）
- [ ] 自动绑定微信支付账户（待微信商户号审核通过）
- [ ] 首次登录引导流程（待实现）

**实际实现情况**：
- 后端API：`POST /api/v1/auth/wechat-login`
- 前端页面：`pages/profile/index.js`
- 登录响应时间 < 2秒 ✓

#### 1.2 扫码支付功能 🔄 **部分实现（等待微信商户号审核）**
**功能描述**：用户通过小程序扫描商户二维码完成支付

**已实现功能**：
- [x] 二维码扫描功能（wx.scanCode）
- [x] 商户信息展示（店名、金额）
- [x] 支付金额确认界面
- [x] 支付结果页面UI
- [x] 积分获得提示动画
- [ ] 微信支付调用（等待微信商户号审核通过）
- [ ] 实际支付流程（受阻于商户号审核）

**实际实现情况**：
- 前端页面：`pages/payment/index.js`
- 支付服务：`services/PaymentService.js`
- 后端API：`POST /api/v1/payments/create`（已开发）
- 当前状态：**代码已完成，等待微信商户号审核（约40分钟）**

#### 1.3 积分查询管理 ✅ **已实现**
**功能描述**：用户查看积分余额、获得记录、使用记录

**已实现功能**：
- [x] 积分总余额展示（大字号金色显示）
- [x] 累计获得、累计消费统计
- [x] 积分获得明细（时间、商户、金额、积分）
- [x] 积分消费记录
- [x] 下拉刷新功能
- [ ] 积分即将过期提醒（未实现过期机制）
- [x] 积分规则说明

**实际实现情况**：
- 前端页面：`pages/points/index.js` + `pages/points/history.js`
- 积分服务：`services/PointsService.js`
- 后端API：`GET /api/v1/points/balance`, `GET /api/v1/points/records`
- UI设计：响应式卡片布局，渐变色背景

#### 1.4 个人中心 ✅ **已实现**
**功能描述**：用户个人信息管理和设置

**已实现功能**：
- [x] 个人信息展示（头像、昵称、用户ID）
- [x] 积分概览（当前余额、累计获得、支付笔数、累计支付）
- [x] 支付历史记录查看
- [x] 积分记录查看
- [x] 登录/退出功能
- [ ] 积分等级展示（未实现等级系统）
- [ ] 常去商户展示（未实现）
- [ ] 设置功能（未实现）
- [ ] 帮助中心（未实现）

**实际实现情况**：
- 前端页面：`pages/profile/index.js`
- Tab Bar导航集成
- 响应式卡片式设计

### 2. 商户端小程序功能 ❌ **未实现（商户端使用管理后台）**

> **说明**：原计划开发商户端小程序，实际实施中决定商户直接使用Web管理后台，更符合商户使用习惯。

#### 2.1 商户登录管理 ❌ **未实现（改为Web管理后台）**
**原计划**：商户通过小程序账号密码登录

**实际实施方案**：
- 商户使用Web管理后台：https://www.guandongfang.cn/admin/
- 管理员账号密码登录
- 功能更强大，操作更便捷

#### 2.2 收款码管理 📋 **已规划（待微信商户号审核）**
**功能描述**：基于微信支付合作伙伴平台，为商户生成专属收款二维码

**当前状态**：
- [ ] 微信商户号审核中（约40分钟）
- [x] 后端API接口已开发（`POST /api/v1/qrcode/generate`）
- [x] 数据库表结构已设计
- [ ] 前端管理界面（待开发）

**已准备的技术实现**：
- **数据来源**：微信支付合作伙伴平台
- **二维码内容**：包含商户ID、平台标识、签名验证
- **跳转逻辑**：扫码后跳转到小程序支付页面
- **存储**：数据库merchants表关联

#### 2.3 交易流水查询 ❌ **未实现（使用管理后台订单管理）**
**原计划**：商户端查看收款记录

**实际实施方案**：
- 商户通过管理后台"订单管理"查看
- 功能包含：订单列表、订单详情、订单统计
- 支持筛选、搜索、导出

#### 2.4 客户管理 ❌ **未实现（使用管理后台用户管理）**
**原计划**：商户端管理支付用户

**实际实施方案**：
- 商户通过管理后台"用户管理"查看
- 功能包含：用户列表、用户详情、积分查询
- 支持搜索、筛选功能

### 3. 管理后台功能 ✅ **已上线（https://www.guandongfang.cn/admin/）**

#### 3.1 用户管理 ✅ **已实现**
**已实现功能**：
- [x] 用户列表查看（分页、搜索）
- [x] 用户详情查看
- [x] 用户积分查询
- [x] 用户状态管理
- [x] 用户数据统计

**实际实现**：
- 前端页面：`admin-frontend/src/App.tsx - UsersPage`
- 后端API：`GET /api/v1/admin/users`
- 数据库表：`users`, `user_points`

#### 3.2 商户管理 ✅ **已实现**
**已实现功能**：
- [x] 商户列表查看（分页、搜索）
- [x] 商户详情查看
- [x] 商户信息编辑
- [x] 商户状态控制（启用/禁用）
- [x] 商户数据统计
- [x] 新增商户功能
- [ ] 商户注册审核流程（未实现）

**实际实现**：
- 前端页面：`admin-frontend/src/App.tsx - MerchantsPage`
- 后端API：`GET /api/v1/admin/merchants`, `POST /api/v1/admin/merchants`
- 数据库表：`merchants`

#### 3.3 订单管理 ✅ **已实现**
**已实现功能**：
- [x] 订单列表查看（分页、筛选）
- [x] 订单详情查看
- [x] 订单统计数据
- [x] 按状态筛选
- [x] 订单搜索功能
- [ ] 退款功能（未实现）

**实际实现**：
- 前端页面：`admin-frontend/src/App.tsx - OrdersPage`
- 后端API：`GET /api/v1/admin/orders`, `GET /api/v1/admin/orders/stats`
- 数据库表：`payment_orders`

#### 3.4 积分管理 ✅ **已实现**
**已实现功能**：
- [x] 积分记录列表
- [x] 积分统计数据
- [x] 按类型筛选（获得/消费）
- [x] 积分详情查看
- [ ] 积分规则配置（未实现）
- [ ] 积分手动调整（未实现）

**实际实现**：
- 前端页面：`admin-frontend/src/App.tsx - PointsPage`
- 后端API：`GET /api/v1/admin/points`
- 数据库表：`point_records`

#### 3.5 管理员管理 ✅ **已实现**
**已实现功能**：
- [x] 管理员列表查看
- [x] 新增管理员
- [x] 编辑管理员信息
- [x] 管理员状态控制
- [x] 权限管理
- [x] 角色分配

**实际实现**：
- 前端页面：`admin-frontend/src/App.tsx - SettingsPage`
- 后端API：`GET /api/v1/admin/admin-users`, `POST /api/v1/admin/admin-users`
- 数据库表：`admin_users`

#### 3.6 仪表板 ✅ **已实现**
**已实现功能**：
- [x] 总用户数统计
- [x] 总商户数统计
- [x] 总订单数统计
- [x] 总积分数统计
- [x] 每日新增数据
- [x] 数据可视化图表

**实际实现**：
- 前端页面：`admin-frontend/src/App.tsx - DashboardPage`
- 后端API：`GET /api/v1/admin/dashboard/stats`

#### 3.7 风控管理 ❌ **未实现**
**说明**：V1.0版本未实现风控功能，计划在V2.0实现

---

## 🎨 用户体验设计

### 支付流程设计

#### 标准支付流程
```
用户打开小程序 → 扫描商户二维码 → 确认支付信息 → 调用微信支付 → 支付成功 → 积分到账提示 → 查看积分余额
```

#### 关键体验点
1. **扫码体验**：快速识别，信息准确
2. **支付确认**：信息清晰，操作简单
3. **积分反馈**：即时提示，数量明确
4. **状态同步**：实时更新，状态准确

### 积分价值传达

#### 积分价值可视化
- **积分图标**：使用金币、星星等视觉符号
- **价值提示**：明确显示"1积分=1元"
- **获得动画**：积分到账时的动态效果
- **等级体系**：根据积分设置用户等级

#### 积分使用引导
- **使用提示**：支付成功后提示积分可用于兑换
- **商城入口**：明显的积分商城入口
- **推荐商品**：根据积分余额推荐合适商品

---

## 🔒 非功能需求

### 性能需求
- **响应时间**：接口响应时间 ≤ 200ms
- **并发处理**：支持1000并发用户
- **系统可用性**：99.9%在线时间
- **数据准确性**：支付和积分数据100%准确

### 安全需求
- **数据传输**：全程HTTPS加密
- **接口安全**：API签名验证
- **用户隐私**：符合《个人信息保护法》
- **支付安全**：符合微信支付安全规范

### 兼容性需求
- **微信版本**：支持微信7.0及以上版本
- **手机系统**：iOS 12+，Android 8.0+
- **网络环境**：2G/3G/4G/5G/WiFi

---

## 📊 数据指标

### 核心业务指标
- **用户注册率**：扫码用户注册转化率 ≥ 60%
- **支付成功率**：支付完成率 ≥ 95%
- **积分发放率**：支付成功后积分发放成功率 100%
- **用户留存率**：7日留存率 ≥ 30%

### 技术性能指标
- **小程序启动时间**：≤ 3秒
- **页面加载时间**：≤ 2秒
- **接口成功率**：≥ 99.5%
- **系统错误率**：≤ 0.1%

### 用户体验指标
- **用户满意度**：≥ 4.5分（5分制）
- **操作便捷性**：支付流程 ≤ 3步完成
- **问题反馈率**：≤ 1%
- **客服咨询率**：≤ 5%

---

## 🎁 竞品分析

### 主要竞品

#### 1. 支付宝积分
**优势**：
- 积分获取渠道多样
- 积分商城商品丰富
- 用户认知度高

**劣势**：
- 积分价值相对较低
- 兑换门槛较高
- 过期机制复杂

#### 2. 京东钢镚
**优势**：
- 积分价值稳定（1钢镚=1元）
- 使用场景丰富
- 获得方式多样

**劣势**：
- 仅限京东生态内使用
- 获得门槛相对较高

### 差异化优势
1. **即付即得**：支付成功立即获得积分
2. **价值透明**：1积分=1元，价值明确
3. **使用便捷**：积分直接可用于消费
4. **商户友好**：帮助商户提升客户粘性

---

## 📅 产品路线图与实施情况

### V1.0 版本（已完成）✅
**时间**：2025年9月24日-26日
**已实现功能**：
- [x] 管理后台完整系统（用户、商户、订单、积分、管理员管理）
- [x] 微信小程序前端（登录、积分查询、个人中心）
- [x] 支付功能代码（等待微信商户号审核）
- [x] 数据库设计和部署
- [x] HTTPS生产环境部署
- [x] 阿里云服务器配置

**未完成功能**：
- [ ] 二维码生成功能（等待微信商户号）
- [ ] 实际微信支付对接（等待审核）
- [ ] 积分商城（计划V2.0）

### V1.1 版本（当前阻塞）⏳
**阻塞原因**：
1. 域名ICP备案审核中（guandongfang.cn）
2. 微信商户号审核中（约40分钟）

**待完成功能**：
- [ ] ICP备案通过
- [ ] 微信支付接口对接
- [ ] 二维码生成和管理
- [ ] 小程序真机测试

### V2.0 版本（计划中）📋
**计划时间**：ICP备案通过后
**计划功能**：
- [ ] 积分商城系统
- [ ] 商品管理
- [ ] 订单处理
- [ ] 物流跟踪
- [ ] 营销工具
- [ ] 数据分析平台

---

## ⚠️ 风险评估

### 技术风险
- **微信生态依赖**：受微信政策影响
- **支付接口稳定性**：第三方服务依赖
- **系统安全性**：资金和数据安全

### 业务风险
- **用户接受度**：新产品市场教育成本
- **商户推广**：商户接受和使用积极性
- **竞品竞争**：市场竞争加剧

### 合规风险
- **支付合规**：符合央行支付监管要求
- **数据保护**：用户隐私保护合规
- **税务处理**：积分相关税务问题

### 应对策略
1. **技术保障**：多重备份、容灾方案
2. **用户教育**：完善的引导和帮助体系
3. **合规保障**：法务团队全程参与
4. **风险监控**：建立完善的风险监控体系

---

## 📊 实施总结

### 已完成功能统计
- **管理后台**：6个核心功能模块，100%完成
- **微信小程序**：3个核心页面，90%完成（支付功能等待商户号）
- **后端API**：30+个接口，100%完成
- **数据库**：6张核心表，100%完成
- **部署运维**：HTTPS、Nginx、PM2，100%完成

### 当前阻塞问题
1. **域名ICP备案**：guandongfang.cn正在审核（阻断核验状态）
2. **微信商户号**：审核中（约40分钟）

### 下一步行动
1. 等待ICP备案通过（优先级最高）
2. 对接微信支付API
3. 开发二维码生成功能
4. 小程序真机测试
5. 开始V2.0积分商城规划

---

**文档状态**：✅ 已完成实施并更新  
**最后更新**：2025年9月30日  
**当前版本**：V2.0（实际实施版本）  
**在线地址**：https://www.guandongfang.cn/admin/
