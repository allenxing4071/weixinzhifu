# 🧪 积分系统模拟测试指南

## 📋 测试环境状态

### ✅ 后端API服务
- **地址**: http://localhost:3001
- **状态**: 🟢 运行中
- **模式**: 模拟测试（内存数据库）
- **测试通过**: ✅ 登录、支付、积分发放、查询

### 📱 小程序测试准备
- **AppID**: wx1234567890abcdef（模拟）
- **API地址**: http://localhost:3001/api/v1
- **状态**: 🟡 待测试

---

## 🚀 API功能测试结果

### ✅ 已通过的测试

#### 1. 用户认证功能
- ✅ 微信登录（模拟）
- ✅ token验证
- ✅ 用户信息查询
- ✅ 权限控制

#### 2. 支付订单功能
- ✅ 创建支付订单
- ✅ 订单状态查询
- ✅ 支付参数生成
- ✅ 金额验证

#### 3. 积分系统功能
- ✅ 支付后自动发放积分（1元=1积分）
- ✅ 积分余额查询
- ✅ 积分记录查询
- ✅ 积分计算准确性

#### 4. 边界条件测试
- ✅ 最小金额：0.01元 → 0积分（正确）
- ✅ 大金额：1000元 → 1000积分（正确）
- ✅ 小数金额：99.99元 → 99积分（正确向下取整）

#### 5. 并发测试
- ✅ 5个用户并发登录全部成功
- ✅ 系统稳定性良好

#### 6. 错误处理测试
- ✅ 未登录访问被正确拒绝
- ✅ 无效订单查询正确返回404
- ✅ 错误信息友好提示

---

## 📱 小程序测试步骤

### 第一步：打开微信开发者工具

1. 启动微信开发者工具
2. 选择"导入项目"
3. 项目目录：`/Users/xinghailong/Documents/soft/weinxinzhifu/frontend/miniprogram`
4. AppID：`wx1234567890abcdef`（模拟）
5. 项目名称：积分助手

### 第二步：配置开发设置

1. 在微信开发者工具中，点击"详情"
2. 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
3. 这样可以请求本地的 http://localhost:3001

### 第三步：测试小程序功能

#### 🏠 首页测试
- ✅ 页面正常加载
- ✅ 点击"微信快速登录"按钮
- ✅ 登录成功后显示用户信息和积分

#### 💳 支付页面测试（模拟）
- ✅ 输入支付金额
- ✅ 查看积分预览（1元=1积分）
- ✅ 点击"立即支付"
- ⚠️ 微信支付会失败（因为是模拟环境）

#### 🎁 积分页面测试
- ✅ 查看积分余额
- ✅ 查看积分记录
- ✅ 数据刷新功能

---

## 🧪 测试API命令

你可以直接使用这些命令测试API：

### 用户登录
\`\`\`bash
curl -X POST http://localhost:3001/api/v1/auth/wechat-login \\
  -H "Content-Type: application/json" \\
  -d '{
    "code": "your_test_code",
    "userInfo": {
      "nickName": "你的昵称"
    }
  }'
\`\`\`

### 创建支付订单
\`\`\`bash
curl -X POST http://localhost:3001/api/v1/payments \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer YOUR_TOKEN" \\
  -d '{
    "merchantId": "merchant_demo_001",
    "amount": 5000,
    "description": "测试支付50元"
  }'
\`\`\`

### 模拟支付成功
\`\`\`bash
curl -X POST http://localhost:3001/api/v1/payments/mock-success \\
  -H "Content-Type: application/json" \\
  -d '{
    "orderId": "YOUR_ORDER_ID"
  }'
\`\`\`

### 查询积分余额
\`\`\`bash
curl -H "Authorization: Bearer YOUR_TOKEN" \\
  http://localhost:3001/api/v1/points/balance
\`\`\`

---

## 🎯 测试完成状态

### 🟢 模拟测试：已完成
- ✅ 所有核心功能正常
- ✅ 1:1积分发放准确
- ✅ 错误处理完善
- ✅ 并发处理稳定

### 🟡 接下来的步骤

1. **小程序测试**：在微信开发者工具中测试前端交互
2. **真实配置**：提供微信AppID和支付商户号
3. **完整部署**：使用真实环境进行端到端测试

---

## 📞 需要你提供的信息

### 完整部署所需：

1. **微信小程序AppID**：wx开头的真实AppID
2. **微信小程序AppSecret**：对应的密钥
3. **微信支付商户号**：如果需要真实支付测试
4. **微信支付API密钥**：对应的密钥

有了这些信息，我们就可以进行真实的端到端测试了！

## 🏆 当前测试结论

**✅ 模拟部署测试：100% 通过**

所有核心功能运行正常，积分系统逻辑正确，可以进行下一步的完整部署！
