<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ç§¯åˆ†åŠ©æ‰‹ - æ‰«ç æ”¯ä»˜</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- å¾®ä¿¡å°ç¨‹åºè·³è½¬å…³é”®é…ç½® -->
    <meta name="wx:appid" content="wx9bed12ef0904d035">
    <meta name="wx:path" content="pages/payment/index">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; color: #333; text-align: center; padding: 20px;
        }
        .container { max-width: 400px; margin: 50px auto; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(45deg, #1AAD19, #07C160); color: white; padding: 40px 20px; }
        .content { padding: 30px 20px; }
        .merchant-info { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 12px; }
        .amount-info { font-size: 24px; color: #1AAD19; font-weight: bold; margin: 15px 0; }
        .jump-btn { width: 100%; background: #1AAD19; color: white; border: none; padding: 16px; border-radius: 8px; font-size: 18px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .tips { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 14px; color: #1976d2; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‰ ç§¯åˆ†åŠ©æ‰‹</h1>
            <p>æ‰«ç æ”¯ä»˜ï¼Œç«‹äº«ç§¯åˆ†å¥–åŠ±</p>
        </div>
        
        <div class="content">
            <div class="merchant-info">
                <h3 id="merchant-name">å•†æˆ·ä¿¡æ¯åŠ è½½ä¸­...</h3>
                <div class="amount-info" id="amount-display">ğŸ’° é‡‘é¢å¾…ç¡®è®¤</div>
            </div>
            
            <div class="tips">
                <p>ğŸ’¡ å¾®ä¿¡æ‰«ç åä¼šè‡ªåŠ¨è·³è½¬åˆ°å°ç¨‹åº</p>
                <p>ğŸ’ æ”¯ä»˜æˆåŠŸç«‹å³è·å¾—ç§¯åˆ†å¥–åŠ±</p>
            </div>
            
            <button class="jump-btn" onclick="jumpToMiniProgram()">
                ğŸš€ ç«‹å³æ‰“å¼€å°ç¨‹åºæ”¯ä»˜
            </button>
        </div>
    </div>

    <script>
        // è·å–URLå‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const merchantId = urlParams.get('merchantId') || 'merchant_real_004';
        const amount = urlParams.get('amount');
        
        // å•†æˆ·ä¿¡æ¯æ˜ å°„
        const merchantNames = {
            'merchant_real_001': 'ä»å¯¿å¿æ€€ä»è¡—é“äº‘é”¦æ±‡ä¼šæ‰€',
            'merchant_real_002': 'ä»å¯¿å¿æ€€ä»è¡—é“å‚¨åºœé±¼åº„åº—', 
            'merchant_real_003': 'ä»å¯¿å¿æ€€ä»è¡—é“é¢å–„æ»‹å…»å›­å…»ç”Ÿé¦†',
            'merchant_real_004': 'æˆéƒ½å¸‚ä¸­é‘«åšæµ·å›½é™…é…’ä¸šè´¸æ˜“æœ‰é™å…¬å¸',
            'merchant_real_005': 'å¾·é˜³å¸‚åæ€ç§‘æŠ€æœ‰é™å…¬å¸'
        };
        
        // æ›´æ–°é¡µé¢ä¿¡æ¯
        document.getElementById('merchant-name').textContent = merchantNames[merchantId] || 'å•†æˆ·';
        document.getElementById('amount-display').textContent = amount ? `ğŸ’° æ”¯ä»˜é‡‘é¢: Â¥${amount}` : 'ğŸ’° é‡‘é¢: ç”¨æˆ·è‡ªå®šä¹‰';
        
        // æ£€æµ‹å¾®ä¿¡ç¯å¢ƒ
        function isWeixin() {
            return /MicroMessenger/i.test(navigator.userAgent);
        }
        
        // è·³è½¬åˆ°å°ç¨‹åº
        function jumpToMiniProgram() {
            if (isWeixin()) {
                // æ„å»ºå°ç¨‹åºè·¯å¾„
                let path = `pages/payment/index?merchantId=${merchantId}`;
                if (amount) {
                    path += `&amount=${amount}`;
                }
                
                console.log('è·³è½¬å°ç¨‹åºè·¯å¾„:', path);
                
                // ä½¿ç”¨å¾®ä¿¡JSSDKè·³è½¬
                if (typeof wx !== 'undefined' && wx.miniProgram) {
                    wx.miniProgram.navigateTo({
                        url: path,
                        success: function() {
                            console.log('è·³è½¬å°ç¨‹åºæˆåŠŸ');
                        },
                        fail: function(res) {
                            console.log('è·³è½¬å°ç¨‹åºå¤±è´¥:', res);
                            // é™çº§å¤„ç†ï¼šæ˜¾ç¤ºæç¤º
                            alert('è¯·åœ¨å¾®ä¿¡ä¸­æ‰“å¼€æ­¤é¡µé¢ä»¥ä½¿ç”¨å°ç¨‹åºæ”¯ä»˜åŠŸèƒ½');
                        }
                    });
                } else {
                    // å°è¯•ä½¿ç”¨URL Schemeè·³è½¬
                    const miniProgramUrl = `weixin://dl/business/?t=*&s=${encodeURIComponent(path)}`;
                    window.location.href = miniProgramUrl;
                }
            } else {
                alert('è¯·åœ¨å¾®ä¿¡ä¸­æ‰«ç æ‰“å¼€æ­¤é¡µé¢');
            }
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨å°è¯•è·³è½¬ï¼ˆå»¶è¿Ÿ1ç§’è®©ç”¨æˆ·çœ‹åˆ°é¡µé¢ï¼‰
        if (isWeixin()) {
            setTimeout(jumpToMiniProgram, 1000);
        }
    </script>
    
    <!-- å¾®ä¿¡JSSDK -->
    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
</body>
</html>
