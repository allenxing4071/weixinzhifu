<!--pages/payment/history.wxml-->
<view class="history-container">
  
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="header-title">æ”¯ä»˜è®°å½•</view>
    <view class="header-subtitle">æŸ¥çœ‹æ‚¨çš„æ‰€æœ‰æ”¯ä»˜è®°å½•å’Œç§¯åˆ†è·å¾—è¯¦æƒ…</view>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="stats-overview card">
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value">{{totalOrders}}</view>
        <view class="stat-label">æ€»æ”¯ä»˜ç¬”æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">Â¥{{totalAmount}}</view>
        <view class="stat-label">ç´¯è®¡æ”¯ä»˜é‡‘é¢</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{totalPoints}}</view>
        <view class="stat-label">ç´¯è®¡è·å¾—ç§¯åˆ†</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">Â¥{{totalPointsValue}}</view>
        <view class="stat-label">ç§¯åˆ†æ€»ä»·å€¼</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filter-section card">
    <view class="filter-tabs">
      <view 
        wx:for="{{filterOptions}}" 
        wx:key="value"
        class="filter-tab {{currentFilter === item.value ? 'active' : ''}}"
        bind:tap="switchFilter"
        data-filter="{{item.value}}"
      >
        {{item.label}}
      </view>
    </view>
  </view>

  <!-- æ”¯ä»˜è®°å½•åˆ—è¡¨ -->
  <view class="records-section">
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner">â³</view>
      <view class="loading-text">åŠ è½½æ”¯ä»˜è®°å½•ä¸­...</view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{records.length === 0}}" class="empty-container card">
      <view class="empty-icon">ğŸ’³</view>
      <view class="empty-title">æš‚æ— æ”¯ä»˜è®°å½•</view>
      <view class="empty-desc">ä½¿ç”¨å¾®ä¿¡æ‰«ä¸€æ‰«æ”¯ä»˜åï¼Œè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</view>
      <button class="btn-primary" bind:tap="goToPayment">å»æ”¯ä»˜</button>
    </view>
    
    <!-- è®°å½•åˆ—è¡¨ -->
    <view wx:else>
      <view 
        wx:for="{{records}}" 
        wx:key="id"
        class="payment-record card"
        bind:tap="viewDetail"
        data-record="{{item}}"
      >
        <view class="record-header">
          <view class="merchant-info">
            <view class="merchant-avatar">{{item.merchantIcon || 'ğŸª'}}</view>
            <view class="merchant-details">
              <view class="merchant-name">{{item.merchantName}}</view>
              <view class="payment-method">{{item.paymentMethod || 'å¾®ä¿¡æ”¯ä»˜'}}</view>
            </view>
          </view>
          <view class="record-time">{{item.formattedTime}}</view>
        </view>
        
        <view class="record-body">
          <view class="transaction-info">
            <view class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</view>
            <view class="transaction-desc">{{item.description}}</view>
          </view>
          
          <view class="amount-points-display">
            <view class="amount-section">
              <view class="amount-label">æ”¯ä»˜é‡‘é¢</view>
              <view class="amount-value">Â¥{{item.formattedAmount}}</view>
            </view>
            <view class="conversion-arrow">â†’</view>
            <view class="points-section">
              <view class="points-label">è·å¾—ç§¯åˆ†</view>
              <view class="points-value">+{{item.pointsAwarded}}</view>
            </view>
          </view>
        </view>
        
        <view class="record-footer">
          <view class="status-info">
            <view class="status-badge {{item.status}}">{{item.statusText}}</view>
            <view class="completion-time">{{item.completedAt}}</view>
          </view>
          <view class="action-buttons">
            <button wx:if="{{item.canRefund}}" class="btn-small btn-outline" bind:tap="requestRefund" data-order="{{item}}">ç”³è¯·é€€æ¬¾</button>
            <button class="btn-small btn-text" bind:tap="viewDetail" data-record="{{item}}">æŸ¥çœ‹è¯¦æƒ…</button>
          </view>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{hasMore}}" class="load-more-section">
        <button 
          class="load-more-btn" 
          bind:tap="loadMore"
          disabled="{{loadingMore}}"
        >
          {{loadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
        </button>
      </view>
      
      <!-- æ²¡æœ‰æ›´å¤š -->
      <view wx:else class="no-more-section">
        <view class="no-more-text">å·²æ˜¾ç¤ºå…¨éƒ¨è®°å½•</view>
      </view>
    </view>
  </view>

</view>