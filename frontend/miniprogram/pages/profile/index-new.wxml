<!--profile/index.wxml-->
<view class="profile-container">
  
  <!-- 用户信息卡片 -->
  <view class="user-card">
    <view wx:if="{{userInfo}}" class="user-content">
      <image class="user-avatar" src="{{userInfo.avatar || 'https://via.placeholder.com/120x120/667eea/ffffff?text=用户'}}"></image>
      <view class="user-details">
        <view class="user-name">{{userInfo.nickname}}</view>
        <view class="user-id">ID: {{userInfo.id}}</view>
        <view class="join-time">注册时间：{{formattedJoinTime}}</view>
      </view>
      <view class="edit-profile" bind:tap="editProfile">
        <view class="edit-icon">✏️</view>
      </view>
    </view>
    
    <!-- 未登录状态 -->
    <view wx:else class="login-card">
      <view class="login-icon">👤</view>
      <view class="login-text">点击登录</view>
      <button class="login-btn" bind:tap="handleLogin">微信登录</button>
    </view>
  </view>

  <!-- 积分概览 -->
  <view wx:if="{{userInfo}}" class="points-overview card">
    <view class="overview-title">积分概览</view>
    <view class="points-grid">
      <view class="points-item" bind:tap="goToPoints">
        <view class="item-value">{{pointsInfo.balance || 0}}</view>
        <view class="item-label">当前余额</view>
      </view>
      <view class="points-item">
        <view class="item-value">{{pointsInfo.totalEarned || 0}}</view>
        <view class="item-label">累计获得</view>
      </view>
      <view class="points-item">
        <view class="item-value">{{paymentInfo.totalOrders || 0}}</view>
        <view class="item-label">支付笔数</view>
      </view>
      <view class="points-item">
        <view class="item-value">¥{{paymentInfo.totalAmount || '0.00'}}</view>
        <view class="item-label">累计支付</view>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view wx:if="{{userInfo}}" class="menu-section">
    
    <!-- 积分相关 -->
    <view class="menu-group card">
      <view class="group-title">积分服务</view>
      <view class="menu-item" bind:tap="goToPoints">
        <view class="item-icon">🎁</view>
        <view class="item-content">
          <view class="item-title">我的积分</view>
          <view class="item-desc">查看积分余额和明细</view>
        </view>
        <view class="item-arrow">→</view>
      </view>
      
      <view class="menu-item" bind:tap="goToMall">
        <view class="item-icon">🛒</view>
        <view class="item-content">
          <view class="item-title">积分商城</view>
          <view class="item-desc">即将上线，敬请期待</view>
        </view>
        <view class="item-badge">即将上线</view>
        <view class="item-arrow">→</view>
      </view>
    </view>
    
    <!-- 消费记录专区 -->
    <view class="consumption-section card">
      <view class="consumption-header">
        <view class="section-icon">📊</view>
        <view class="section-title">消费记录</view>
        <view class="section-subtitle">查看您的所有消费和积分明细</view>
      </view>
      
      <view class="consumption-stats">
        <view class="stat-card" bind:tap="togglePaymentHistory">
          <view class="stat-icon">💳</view>
          <view class="stat-info">
            <view class="stat-number">{{paymentInfo.totalOrders || 0}}</view>
            <view class="stat-label">支付笔数</view>
          </view>
        </view>
        
        <view class="stat-card" bind:tap="togglePaymentHistory">
          <view class="stat-icon">💰</view>
          <view class="stat-info">
            <view class="stat-number">¥{{paymentInfo.totalAmount || '0.00'}}</view>
            <view class="stat-label">累计消费</view>
          </view>
        </view>
      </view>
      
      <view class="consumption-actions">
        <button class="consumption-btn" bind:tap="togglePaymentHistory">
          <view class="btn-icon">📄</view>
          <view class="btn-text">{{showPaymentHistory ? '收起记录' : '查看详细记录'}}</view>
          <view class="btn-arrow">{{showPaymentHistory ? '↓' : '→'}}</view>
        </button>
      </view>
      
      <!-- 支付记录列表 -->
      <view wx:if="{{showPaymentHistory}}" class="payment-history-list">
        <view class="history-header">
          <view class="header-title">支付明细</view>
          <view class="header-subtitle">显示最近10条记录</view>
        </view>
        
        <!-- 加载状态 -->
        <view wx:if="{{loadingHistory}}" class="history-loading">
          <view class="loading-icon">⏳</view>
          <view class="loading-text">加载中...</view>
        </view>
        
        <!-- 空状态 -->
        <view wx:elif="{{paymentHistory.length === 0}}" class="history-empty">
          <view class="empty-icon">📄</view>
          <view class="empty-text">暂无支付记录</view>
          <view class="empty-desc">使用微信扫一扫支付后即可查看</view>
        </view>
        
        <!-- 记录列表 -->
        <view wx:else class="history-records">
          <view 
            wx:for="{{paymentHistory}}" 
            wx:key="id"
            class="payment-record"
            bind:tap="viewPaymentDetail"
            data-order="{{item}}"
          >
            <view class="record-header">
              <view class="record-merchant">
                <view class="merchant-icon">🏦</view>
                <view class="merchant-name">{{item.merchantName || '商户支付'}}</view>
              </view>
              <view class="record-time">{{item.formattedTime}}</view>
            </view>
            
            <view class="record-content">
              <view class="record-desc">{{item.description || '微信支付'}}</view>
              <view wx:if="{{item.orderNo}}" class="record-order">订单号：{{item.orderNo}}</view>
            </view>
            
            <view class="record-footer">
              <view class="payment-amount">
                <view class="amount-label">支付金额</view>
                <view class="amount-value">¥{{item.formattedAmount}}</view>
              </view>
              <view class="points-reward">
                <view class="reward-label">获得积分</view>
                <view class="reward-value">+{{item.pointsAwarded || item.amount}}</view>
              </view>
            </view>
            
            <view class="record-status">
              <view class="status-badge {{item.status}}">{{item.statusText || '支付成功'}}</view>
            </view>
          </view>
        </view>
        
        <!-- 查看更多 -->
        <view wx:if="{{paymentHistory.length >= 10}}" class="view-more">
          <button class="more-btn" bind:tap="goToFullHistory">查看全部记录</button>
        </view>
      </view>
    </view>
    
    <!-- 设置相关 -->
    <view class="menu-group card">
      <view class="group-title">设置</view>
      <view class="menu-item" bind:tap="showAbout">
        <view class="item-icon">ℹ️</view>
        <view class="item-content">
          <view class="item-title">关于我们</view>
          <view class="item-desc">了解积分助手</view>
        </view>
        <view class="item-arrow">→</view>
      </view>
      
      <view class="menu-item" bind:tap="showUserAgreement">
        <view class="item-icon">📄</view>
        <view class="item-content">
          <view class="item-title">用户协议</view>
          <view class="item-desc">查看服务条款</view>
        </view>
        <view class="item-arrow">→</view>
      </view>
      
      <view class="menu-item" bind:tap="showPrivacyPolicy">
        <view class="item-icon">🔒</view>
        <view class="item-content">
          <view class="item-title">隐私政策</view>
          <view class="item-desc">了解隐私保护</view>
        </view>
        <view class="item-arrow">→</view>
      </view>
    </view>
    
    <!-- 客服和帮助 -->
    <view class="menu-group card">
      <view class="group-title">帮助与反馈</view>
      <view class="menu-item" bind:tap="contactService">
        <view class="item-icon">📞</view>
        <view class="item-content">
          <view class="item-title">联系客服</view>
          <view class="item-desc">遇到问题？联系我们</view>
        </view>
        <view class="item-arrow">→</view>
      </view>
      
      <view class="menu-item" bind:tap="showHelp">
        <view class="item-icon">❓</view>
        <view class="item-content">
          <view class="item-title">常见问题</view>
          <view class="item-desc">查看帮助文档</view>
        </view>
        <view class="item-arrow">→</view>
      </view>
    </view>
    
    <!-- 退出登录 -->
    <view class="logout-section">
      <button class="logout-btn" bind:tap="handleLogout">退出登录</button>
    </view>
  </view>

  <!-- 版本信息 -->
  <view class="version-info">
    <view class="version-text">积分助手 v{{version}}</view>
  </view>

</view>
