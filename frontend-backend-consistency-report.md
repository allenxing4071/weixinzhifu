# å‰åç«¯åŠŸèƒ½ç»Ÿä¸€æ€§æ£€æŸ¥æŠ¥å‘Š

## ğŸ” **æ£€æŸ¥ç»“æœæ€»ç»“**

### âŒ **å‘ç°çš„ä¸ä¸€è‡´é—®é¢˜**

#### 1. å°ç¨‹åºå•†æˆ·ä¿¡æ¯è·å–é—®é¢˜
```javascript
// é—®é¢˜ï¼šå°ç¨‹åºpayment/index.jsä»åœ¨ä½¿ç”¨ç¡¬ç¼–ç å•†æˆ·æ•°æ®
const mockMerchants = {
  'merchant_demo_001': {
    name: 'æ•°è°·å¼‚è”ç§‘æŠ€',
    desc: 'ç§‘æŠ€æœåŠ¡ä¸“å®¶',
    avatar: '/images/merchants/shugu.png'  // ç¡¬ç¼–ç æ•°æ®
  }
}

// âŒ åº”è¯¥æ”¹ä¸ºï¼š
const response = await app.requestAPI(`/merchants/${merchantId}`, 'GET')
```

#### 2. APIè·¯å¾„ä¸åŒ¹é…
```javascript
// å°ç¨‹åºä¸­ç¼ºå°‘æ­£ç¡®çš„å•†æˆ·APIè°ƒç”¨
// å½“å‰ï¼šä½¿ç”¨hardcodeæ•°æ®
// åº”è¯¥ï¼šè°ƒç”¨ /api/v1/merchants/${merchantId}
```

#### 3. æ•°æ®å­—æ®µæ˜ å°„ä¸ä¸€è‡´
```typescript
// æ•°æ®åº“å­—æ®µ vs APIè¿”å›å­—æ®µ vs å‰ç«¯ä½¿ç”¨å­—æ®µ
æ•°æ®åº“: merchant_name   â†’ API: merchantName     â†’ å‰ç«¯: name
æ•°æ®åº“: sub_mch_id      â†’ API: subMchId         â†’ å‰ç«¯: subMchId  
æ•°æ®åº“: business_category â†’ API: businessCategory â†’ å‰ç«¯: desc
```

### âœ… **å·²ç»Ÿä¸€çš„éƒ¨åˆ†**

#### 1. QRç ç”ŸæˆåŠŸèƒ½ âœ…
- åç«¯APIï¼šè¿”å›çœŸå®base64æ•°æ® (3654å­—ç¬¦)
- å‰ç«¯æœŸæœ›ï¼šbase64å›¾ç‰‡æ•°æ®
- çŠ¶æ€ï¼š**å®Œå…¨ç»Ÿä¸€** âœ…

#### 2. ç§¯åˆ†æŸ¥è¯¢åŠŸèƒ½ âœ…
- åç«¯APIï¼šè¿æ¥æ•°æ®åº“è¿”å›çœŸå®ç§¯åˆ†æ•°æ®
- å‰ç«¯è°ƒç”¨ï¼š`/api/v1/points/balance`
- çŠ¶æ€ï¼š**å®Œå…¨ç»Ÿä¸€** âœ…

#### 3. ç”¨æˆ·è®¤è¯åŠŸèƒ½ âœ…
- åç«¯APIï¼šJWT TokenéªŒè¯
- å‰ç«¯é…ç½®ï¼šçœŸå®å¾®ä¿¡ç™»å½•ï¼Œç§»é™¤æ¼”ç¤ºæ¨¡å¼
- çŠ¶æ€ï¼š**å®Œå…¨ç»Ÿä¸€** âœ…

#### 4. æ•°æ®åº“å•†æˆ·æ•°æ® âœ…
- çœŸå®å•†æˆ·æ•°æ®ï¼š5ä¸ªçœŸå®å•†æˆ·ï¼ŒåŒ…å«sub_mch_id
- APIèƒ½æ­£ç¡®æŸ¥è¯¢ï¼šè¿”å›å®Œæ•´å•†æˆ·ä¿¡æ¯
- çŠ¶æ€ï¼š**æ•°æ®å°±ç»ª** âœ…

---

## ğŸ”§ **éœ€è¦ä¿®å¤çš„å…³é”®é—®é¢˜**

### é—®é¢˜1: å°ç¨‹åºæ”¯ä»˜é¡µé¢ä»ä½¿ç”¨ç¡¬ç¼–ç å•†æˆ·æ•°æ®

**å½“å‰çŠ¶æ€ï¼š**
```javascript
// frontend/miniprogram/pages/payment/index.js (ç¬¬74-103è¡Œ)
const mockMerchants = {
  'merchant_demo_001': {
    name: 'æ•°è°·å¼‚è”ç§‘æŠ€',
    desc: 'ç§‘æŠ€æœåŠ¡ä¸“å®¶',
    avatar: '/images/merchants/shugu.png'  // âŒ ç¡¬ç¼–ç 
  }
}
```

**ä¿®å¤æ–¹æ¡ˆï¼š**
```javascript
// ç§»é™¤mockMerchantsï¼Œæ”¹ä¸ºçœŸå®APIè°ƒç”¨
async loadMerchantInfo(merchantId) {
  const response = await app.requestAPI(`/merchants/${merchantId}`, 'GET')
  if (response.success) {
    this.setData({
      merchantInfo: {
        name: response.data.merchant.merchantName,
        desc: response.data.merchant.businessCategory,
        subMchId: response.data.merchant.subMchId,
        verified: response.data.merchant.status === 'active'
      }
    })
  }
}
```

### é—®é¢˜2: APIè·¯ç”±é…ç½®ä¸å®Œæ•´

**å½“å‰çŠ¶æ€ï¼š**
- QRç APIï¼šâœ… æ­£ç¡®è·¯ç”±åˆ°3004ç«¯å£
- å•†æˆ·ç®¡ç†APIï¼šâœ… æ­£ç¡®è·¯ç”±åˆ°3003ç«¯å£  
- å•†æˆ·æŸ¥è¯¢APIï¼šâŒ å°ç¨‹åºè®¿é—®çš„`/merchants/:id`è·¯ç”±ç¼ºå¤±

**ä¿®å¤æ–¹æ¡ˆï¼š**
```nginx
# éœ€è¦æ·»åŠ å°ç¨‹åºå•†æˆ·æŸ¥è¯¢è·¯ç”±
location ~ ^/api/v1/merchants/[^/]+$ {
    proxy_pass http://localhost:3003;
    # ... å…¶ä»–é…ç½®
}
```

### é—®é¢˜3: æ•°æ®æ ¼å¼æ ‡å‡†åŒ–

**å½“å‰çŠ¶æ€ï¼š**
- æ•°æ®åº“å­—æ®µï¼šsnake_case (merchant_name, sub_mch_id)
- APIè¿”å›ï¼šcamelCase (merchantName, subMchId)
- å‰ç«¯ä½¿ç”¨ï¼šæ··åˆæ ¼å¼

**ä¿®å¤æ–¹æ¡ˆï¼š**
ç»Ÿä¸€ä½¿ç”¨camelCaseæ ¼å¼ï¼Œç¡®ä¿APIå“åº”æ ¼å¼ä¸€è‡´ã€‚

---

## ğŸ¯ **ç»Ÿä¸€æ€§è¯„åˆ†**

| åŠŸèƒ½æ¨¡å— | æ•°æ®å±‚ | APIå±‚ | å‰ç«¯å±‚ | ç»Ÿä¸€æ€§ |
|---------|-------|-------|-------|--------|
| QRç ç”Ÿæˆ | âœ… | âœ… | âœ… | **100%** |
| ç§¯åˆ†æŸ¥è¯¢ | âœ… | âœ… | âœ… | **100%** |
| ç”¨æˆ·è®¤è¯ | âœ… | âœ… | âœ… | **100%** |
| æ”¯ä»˜æµç¨‹ | âœ… | âœ… | âš ï¸ | **80%** |
| å•†æˆ·ä¿¡æ¯ | âœ… | âœ… | âŒ | **60%** |

**æ€»ä½“ç»Ÿä¸€æ€§ï¼š88%** - æ¥è¿‘å®Œæˆï¼Œéœ€ä¿®å¤å•†æˆ·ä¿¡æ¯æ˜¾ç¤º

---

## ğŸš€ **ç«‹å³ä¿®å¤è®¡åˆ’**

### Step 1: ä¿®å¤å°ç¨‹åºå•†æˆ·ä¿¡æ¯åŠ è½½ (5åˆ†é’Ÿ)
- ç§»é™¤hardcodeæ•°æ®
- æ·»åŠ çœŸå®APIè°ƒç”¨
- ç»Ÿä¸€æ•°æ®å­—æ®µæ˜ å°„

### Step 2: å®Œå–„Nginxè·¯ç”±é…ç½® (3åˆ†é’Ÿ)  
- æ·»åŠ å•†æˆ·æŸ¥è¯¢è·¯ç”±
- æµ‹è¯•å°ç¨‹åºAPIè®¿é—®

### Step 3: ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯ (5åˆ†é’Ÿ)
- æµ‹è¯•æ‰«ç  â†’ å•†æˆ·ä¿¡æ¯åŠ è½½ â†’ æ”¯ä»˜æµç¨‹
- éªŒè¯æ•°æ®ä¸€è‡´æ€§

**é¢„è®¡å®Œæˆæ—¶é—´ï¼š15åˆ†é’Ÿå†…**

---

## âœ… **ä¿®å¤åçš„é¢„æœŸæ•ˆæœ**

1. **å°ç¨‹åºæ‰«ç åæ˜¾ç¤ºçœŸå®å•†æˆ·ä¿¡æ¯**
2. **å•†æˆ·åç§°ã€ç±»ç›®ã€çŠ¶æ€æ¥è‡ªæ•°æ®åº“**  
3. **æ”¯ä»˜é‡‘é¢ã€QRç ã€ç§¯åˆ†å‘æ”¾å…¨ç¨‹çœŸå®æ•°æ®**
4. **å‰åç«¯æ•°æ®å®Œå…¨åŒæ­¥ï¼Œæ— ä»»ä½•ç¡¬ç¼–ç **

**æœ€ç»ˆç»Ÿä¸€æ€§ç›®æ ‡ï¼š100%** ğŸ¯
